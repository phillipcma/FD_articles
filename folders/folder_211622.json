[
  {
    "id": 130228,
    "type": 1,
    "status": 1,
    "agent_id": 3012089524,
    "created_at": "2013-09-02T07:43:13Z",
    "category_id": 81239,
    "folder_id": 211622,
    "title": "Invoices",
    "updated_at": "2020-04-10T07:36:40Z",
    "description": "<h1 id=\"INVOICES\">INVOICES</h1>\n<p><br></p>\n<p>\nThe invoice is sent at the end of the billing period. You should set the\n email in the Address info for the customer/account. At this moment \ninvoice editor is in the stage of development. So there is only one \ndefault template available. <br></p>\n<p><br></p>\n<h2 id=\"Aboutinvoicegenerating\">About invoice generating</h2>\n<p><br></p>\n<p>\nIf invoicing feature is not working, please check if exist the following on server:\n</p>\n<pre class=\"wiki\">[ssp-root@sbc01 ~]$ pkg_info|grep fop\nfop-1.0             Print formatter driven by XSL formatting\n\n[ssp-root@sbc01 ~]$ pkg_info|grep webfonts\nwebfonts-0.30_6     TrueType core fonts for the Web\n\n</pre>\n<p>\nIf one of them is not available then please <strong>\"make install\"</strong> of pkg. In case if it finishes without any progress in 1 sec - sudo make clean\n</p>\n<p>\n<strong>Webfonts</strong> - you can find it in the <strong>/usr/ports/x11-fonts/webfonts</strong>.\n</p>\n<p>\n<strong>FOP</strong> - you can find it in the <strong>/usr/ports/textproc/fop</strong>\n</p>\n<hr>\n<p>\n<strong>How to check if invoicing working fine:</strong>\n</p>\n<p>\nNote: on the first billing run for an account, an invoice will not be generated. <br></p>\n<p><br></p>\n<p>\nPlease create the test account with your email and send the test email with invoice.\n</p>\n<pre class=\"wiki\">1. psql -U sippy -c \"update accounts set next_billing_time=now() where username='test'\";\n2. sudo ~ssp/apps/billingd/billingd.py\n\n\n</pre>\n<p>\n<strong>\n</strong></p>\n<h2 id=\"Youcanalsousebftforthisneed:\">You can also use bft for this need:</h2>\n<p>\n<strong>\n</strong></p>\n<p>\n<strong>1. Check what is i_environment of needed environment</strong>\n</p>\n<pre class=\"wiki\">ei\n</pre>\n<p>\n<strong>2. Create bft account:</strong>\n</p>\n<pre class=\"wiki\">cd /home/ssp/scripts/support_tools/; sudo rm ./bft.py; sudo cvs -d your_ldap_login@cvsro.sippysoft.com:/home/ncvs up bft.py; sudo ./bft.py -c 1\n</pre>\n<p>\n<strong>3. Set your email:</strong>\n</p>\n<pre class=\"wiki\">psql -U sippy -c \"update contacts set email = 'your_email@sippysoft.com' where i_contact = (select i_contact from accounts where username = 'sippy_support_bft')\"; \n</pre>\n<p>\n<strong>4. Update its billing_time and restart billingd (the example is \nfor default invoice template, to change it - correct this query, or make\n needed changes on web):</strong>\n</p>\n<pre class=\"wiki\">psql -U sippy -c \"update accounts set invoicing_enabled = true, next_billing_time=now() where username='sippy_support_bft'\"; sudo ~ssp/apps/billingd/billingd.py\n</pre>\n<p>\n<strong>5. Check maillog, ssp_maildlog in the respective jailed \nenvironment (/var/env##/log/ssp_maild.log)and your own email. Do not \nforget to delete bft after you finish working there:</strong>\n</p>\n<pre class=\"wiki\">sudo ./bft.py -d 1\n\n\n</pre>\n<h2 id=\"Atinyscriptforthisactivity:\"><strong>A tiny script for this activity:</strong></h2>\n<p>\n<i>1. Create the file:</i> \n</p>\n<pre class=\"wiki\">sudo ee /home/ssp-root/inv\n</pre>\n<p>\n<i>2. Insert there the following code:</i>\n</p>\n<pre class=\"wiki\">echo \"Moving to support_tools\" \ncd /home/ssp/scripts/support_tools/ &amp;&amp; rm ./bft.py\necho \"Please enter your_ldap_login\"\nread your_ldap_login\n# Update bft\ncvs -d ${your_ldap_login}@cvsro.sippysoft.com:/home/ncvs up bft.py &amp;&amp; \npsql -U sippy -c \"select i_environment, assigned_ips, name, description, enabled  from environments order by i_environment asc;\" sippy &amp;&amp;\necho \"Enter i_environment\"\nread i_environment\n./bft.py -c ${i_environment} &amp;&amp;\npsql -U sippy -c \"update contacts set email = '${your_ldap_login}@sippysoft.com' where i_contact = (select i_contact from accounts where username = 'sippy_support_bft');\" sippy  &amp;&amp; \npsql -U sippy -c \"update accounts set invoicing_enabled = true, next_billing_time=now() where username='sippy_support_bft';\" sippy &amp;&amp;\nsudo ~ssp/apps/billingd/billingd.py &amp;&amp;\nsleep 2\nread -p \"Check maillog, /var/env##/log/ssp_maild.log, messages and your own email. Press Enter to delete bft and exit\"\n/usr/home/ssp/scripts/support_tools/bft.py -d ${i_environment}\n</pre>\n<p>\n<i>3. Run the script:</i>\n</p>\n<pre class=\"wiki\">sudo bash /home/ssp-root/inv\n</pre>\n<p>\u00a0</p>",
    "description_text": " INVOICES \n   \n \nThe invoice is sent at the end of the billing period. You should set the\n email in the Address info for the customer/account. At this moment \ninvoice editor is in the stage of development. So there is only one \ndefault template available.   \n   \n About invoice generating \n   \n \nIf invoicing feature is not working, please check if exist the following on server:\n \n [ssp-root@sbc01 ~]$ pkg_info|grep fop\nfop-1.0             Print formatter driven by XSL formatting\n\n[ssp-root@sbc01 ~]$ pkg_info|grep webfonts\nwebfonts-0.30_6     TrueType core fonts for the Web\n\n \n \nIf one of them is not available then please \"make install\" of pkg. In case if it finishes without any progress in 1 sec - sudo make clean\n \n \nWebfonts - you can find it in the /usr/ports/x11-fonts/webfonts.\n \n \nFOP - you can find it in the /usr/ports/textproc/fop\n \n \n \nHow to check if invoicing working fine:\n \n \nNote: on the first billing run for an account, an invoice will not be generated.   \n   \n \nPlease create the test account with your email and send the test email with invoice.\n \n 1. psql -U sippy -c \"update accounts set next_billing_time=now() where username='test'\";\n2. sudo ~ssp/apps/billingd/billingd.py\n\n\n \n \n\n \n You can also use bft for this need: \n \n\n \n \n1. Check what is i_environment of needed environment\n \n ei\n \n \n2. Create bft account:\n \n cd /home/ssp/scripts/support_tools/; sudo rm ./bft.py; sudo cvs -d your_ldap_login@cvsro.sippysoft.com:/home/ncvs up bft.py; sudo ./bft.py -c 1\n \n \n3. Set your email:\n \n psql -U sippy -c \"update contacts set email = 'your_email@sippysoft.com' where i_contact = (select i_contact from accounts where username = 'sippy_support_bft')\"; \n \n \n4. Update its billing_time and restart billingd (the example is \nfor default invoice template, to change it - correct this query, or make\n needed changes on web):\n \n psql -U sippy -c \"update accounts set invoicing_enabled = true, next_billing_time=now() where username='sippy_support_bft'\"; sudo ~ssp/apps/billingd/billingd.py\n \n \n5. Check maillog, ssp_maildlog in the respective jailed \nenvironment (/var/env##/log/ssp_maild.log)and your own email. Do not \nforget to delete bft after you finish working there:\n \n sudo ./bft.py -d 1\n\n\n \n A tiny script for this activity: \n \n1. Create the file: \n \n sudo ee /home/ssp-root/inv\n \n \n2. Insert there the following code:\n \n echo \"Moving to support_tools\" \ncd /home/ssp/scripts/support_tools/ && rm ./bft.py\necho \"Please enter your_ldap_login\"\nread your_ldap_login\n# Update bft\ncvs -d ${your_ldap_login}@cvsro.sippysoft.com:/home/ncvs up bft.py && \npsql -U sippy -c \"select i_environment, assigned_ips, name, description, enabled  from environments order by i_environment asc;\" sippy &&\necho \"Enter i_environment\"\nread i_environment\n./bft.py -c ${i_environment} &&\npsql -U sippy -c \"update contacts set email = '${your_ldap_login}@sippysoft.com' where i_contact = (select i_contact from accounts where username = 'sippy_support_bft');\" sippy  && \npsql -U sippy -c \"update accounts set invoicing_enabled = true, next_billing_time=now() where username='sippy_support_bft';\" sippy &&\nsudo ~ssp/apps/billingd/billingd.py &&\nsleep 2\nread -p \"Check maillog, /var/env##/log/ssp_maild.log, messages and your own email. Press Enter to delete bft and exit\"\n/usr/home/ssp/scripts/support_tools/bft.py -d ${i_environment}\n \n \n3. Run the script:\n \n sudo bash /home/ssp-root/inv\n \n \u00a0 ",
    "seo_data": {
      "meta_title": "",
      "meta_description": "",
      "meta_keywords": ""
    },
    "tags": [],
    "attachments": [],
    "cloud_files": [],
    "thumbs_up": 0,
    "thumbs_down": 0,
    "hits": 0,
    "suggested": 0,
    "feedback_count": 0
  },
  {
    "id": 130229,
    "type": 1,
    "status": 2,
    "agent_id": 3763909,
    "created_at": "2013-09-02T07:44:12Z",
    "category_id": 81239,
    "folder_id": 211622,
    "title": "Re-generate invoices",
    "updated_at": "2021-06-10T11:11:59Z",
    "description": "<pre class=\"wiki\">psql -U sippy sippyX \n</pre>\n<pre class=\"wiki\">INSERT INTO invoice_queue (\"period_begin\", \"period_end\", i_account, i_billing_plan) VALUES ('start_date','end_date', 'i_accountX', 'i_billing_planX');\n</pre>\n<p><br></p>\n<p>Next step will be:\n</p>\n<pre class=\"wiki\">/tmp/envX/invoiced.sh start\n\n</pre>\n<p>\n\"start_date\" and \"end_date\"  - you should set account's timezone time. \n</p>\n<p>\nFor example:\n</p>\n<pre class=\"wiki\"><b>INSERT INTO invoice_queue (\"period_begin\", \"period_end\", i_account, i_billing_plan) VALUES ('2013-07-04 17:00:00+00','2013-07-08 00:00:00+00', '5', '7');\n\n</b>\n\nif records already exists in queue, it can value for column \"done\" to be reset to 'false':\n<b>update invoice_queue set done ='FALSE';\n</b>\nthen\n<b>sudo ~ssp/apps/billingd/billingd.py</b>\n<b>sudo /home/ssp/scripts/crontab_wrapper.sh invoiced.sh</b>\n</pre>\n<p>\nCrontab_wrapper instead of /tmp/envX/invoiced.sh start was suggested by \nAndriy - in that way there is less possibility to execute invoiced.sh \ntwice which could result in stucked processes and errors.\n</p>\n<p>\u00a0</p>",
    "description_text": " psql -U sippy sippyX \n \n INSERT INTO invoice_queue (\"period_begin\", \"period_end\", i_account, i_billing_plan) VALUES ('start_date','end_date', 'i_accountX', 'i_billing_planX');\n \n   \n Next step will be:\n \n /tmp/envX/invoiced.sh start\n\n \n \n\"start_date\" and \"end_date\"  - you should set account's timezone time. \n \n \nFor example:\n \n INSERT INTO invoice_queue (\"period_begin\", \"period_end\", i_account, i_billing_plan) VALUES ('2013-07-04 17:00:00+00','2013-07-08 00:00:00+00', '5', '7');\n\n\n\nif records already exists in queue, it can value for column \"done\" to be reset to 'false':\nupdate invoice_queue set done ='FALSE';\n\nthen\nsudo ~ssp/apps/billingd/billingd.py\nsudo /home/ssp/scripts/crontab_wrapper.sh invoiced.sh\n \n \nCrontab_wrapper instead of /tmp/envX/invoiced.sh start was suggested by \nAndriy - in that way there is less possibility to execute invoiced.sh \ntwice which could result in stucked processes and errors.\n \n \u00a0 ",
    "seo_data": {
      "meta_title": "",
      "meta_description": "",
      "meta_keywords": ""
    },
    "tags": [],
    "attachments": [],
    "cloud_files": [],
    "thumbs_up": 0,
    "thumbs_down": 0,
    "hits": 0,
    "suggested": 0,
    "feedback_count": 0
  }
]