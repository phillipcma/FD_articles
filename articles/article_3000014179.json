{
  "id": 3000014179,
  "type": 1,
  "status": 2,
  "agent_id": 3030958764,
  "created_at": "2014-07-14T09:20:06Z",
  "category_id": 155349,
  "folder_id": 255859,
  "title": "Customize and add Invoice Templates",
  "updated_at": "2020-03-31T18:43:05Z",
  "description": "<h1 data-darkreader-inline-color=\"\" id=\"Invoicing\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 19px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>Invoicing</h1><h2 data-darkreader-inline-color=\"\" id=\"Invoicetemplates\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 16px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>Invoice templates</h2><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>Invoice templates are the XHTML documents with embedded macros that are converted into the XSL Formatting Objects using the ~ssp/etc/xsl/xhtml2fo.xsl, the slightly modified version of the style sheet from <a href=\"http://antennahouse.com/\" style=\"color: rgb(187, 0, 0); --darkreader-inline-color:#ff5c5c;\">http://antennahouse.com/</a>. The resulting XSL FO document is finally converted into the PDF file using <a href=\"http://xmlgraphics.apache.org/fop/\" style=\"color: rgb(187, 0, 0); --darkreader-inline-color:#ff5c5c;\">Apache FOP</a>. Starting from Sippy 5.0, version <a href=\"https://wkhtmltopdf.org/\">wkhtmltopdf</a> is used as PDF converter.</p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>The invoice templates are stored in the database, table invoice_templates. The templates with the i_invoice_template field values in the 1 to 1000 range are system templates, they are additionally filed as: \u00a0invoice_templates.is_system = True</p><h3 data-darkreader-inline-color=\"\" id=\"Invoicetemplatesforaccounts\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><br></h3><h3 data-darkreader-inline-color=\"\" id=\"Invoicetemplatesforaccounts\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>Invoice templates for accounts</h3><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>An invoice template is a mandatory attribute of a Service Plan (billing_plans.i_invoice_template). \u00a0The invoice template has a system default value (see below). \u00a0Accounts have <em>optional</em> attributes for invoice templates (accounts.i_invoice_template) which can override the setting from the Service Plan. \u00a0Accounts also have settings to enable the generation of invoices. \u00a0Invoices can be sent via e-mail to addresses specified in the contacts of the Account, filed as: accounts.invoicing_enabled</p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>On the Sippy interface the Account can view the type of invoice which is enabled by checking \"Invoicing Enabled\" in his settings (the sub-Account, after logging in can change it.)</p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>Invoice templates can be chosen from the Invoice Template list after invoicing is enabled. \u00a0</p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>The same could be done using the bulk upload feature for multiple Accounts.</p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><h3 data-darkreader-inline-color=\"\" id=\"Currentlyassignedsystemtemplates\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>Currently assigned system templates</h3><h1 data-darkreader-inline-color=\"\" id=\"Invoicing\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 19px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Invoicing\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h1><h3 data-darkreader-inline-color=\"\" id=\"Invoicetemplatesforaccounts\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Invoicetemplatesforaccounts\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h3><h3 data-darkreader-inline-color=\"\" id=\"Currentlyassignedsystemtemplates\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Currentlyassignedsystemtemplates\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h3><ul><li><strong>1</strong> - The default invoice template for accounts</li></ul><hr><p><span style=\"font-size: 24px;\"><strong>Creating a custom invoice template</strong></span></p><p><br></p><p><br></p><p>It is recommended that you avoid changing the Default invoice template. \u00a0By using the following strategy you'll always keep one Default working invoice template and will be able adjust a custom one on your own.</p><ol><li>Log into your switch and open the page which contains a list of all invoice templates. <strong>Starting from 5.2 version of Sippy\u00a0</strong>the page is available under Customers - Invoicing - Invoice Templates menu, in earlier versions it is hidden, so you need to type \"invoice_templates.php\" manually in your browser's address line. The full link looks as <span data-darkreader-inline-color=\"\" style=\"color: rgb(44, 130, 201); --darkreader-inline-color:#6baddf;\"><a href=\"https://11.22.33.44/c1/invoice_templates.php\" rel=\"noreferrer\">https://11.22.33.44/c1/invoice_templates.php</a></span> (where 11.22.33.44 is the address or domain name of your switch).</li><li>By default, only one template is available called \"Default...\". Open it and copy the HTML content of the Default invoice template into a clipboard or a notepad, or press Add Based on Existing button on Invoice Templates page (<strong>starting from 5.2</strong>)<br><img class=\"fr-dib fr-fil\" src=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3036594944/original/XA7lr5pLn27Afe4WunQbX1fFWJ4rXFQL5Q?1526888862\" data-filelink=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3036594944/original/XA7lr5pLn27Afe4WunQbX1fFWJ4rXFQL5Q?1526888862\" data-fileid=\"3036594944\" data-uniquekey=\"1526888310529\"><img class=\"fr-dib fr-fil\" src=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3036594963/original/5dUr08AmKU-ShEdyXQaE02kSNSK89R9Eow?1526888934\" data-filelink=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3036594963/original/5dUr08AmKU-ShEdyXQaE02kSNSK89R9Eow?1526888934\" data-fileid=\"3036594963\" data-uniquekey=\"1526888310529\"><br></li><li><p>Next, go back to the invoice_templates.php page and click \"Add New Invoice Template\".</p></li><li><p>Open HTML editor again.</p></li><li><p>Paste the HTML content which you copied at step #2.</p></li><li><p>Save the template. Now you have a full copy of the Default working invoice template which you can customize on your own.</p></li></ol><hr style='margin-top: 2em; margin-bottom: 2em; color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;' data-darkreader-inline-color=\"\"><p><span style=\"font-size: 24px;\"><strong>Available macros list</strong></span></p><p>Starting from 5.0 version of Sippy the list of available macros are accessible from invoice editor:</p><p><img data-uniquekey=\"1493215478889\" data-fileid=\"3028173884\" data-filelink=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3028173884/original/X3ycuv5rx7D1QkEoghDuEVLocW0X5zk4MA.jpg?1493215754\" class=\"fr-dib\" src=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3028173884/original/X3ycuv5rx7D1QkEoghDuEVLocW0X5zk4MA.jpg?1493215754\"></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><br></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><span style=\"font-family: Verdana,Geneva,sans-serif;\"><strong><span style=\"font-size: 16px;\">Macros that contain the attributes of an account:</span></strong></span></p><h2 data-darkreader-inline-color=\"\" id=\"Macrosubstitutions\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 16px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Macrosubstitutions\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h2><h3 data-darkreader-inline-color=\"\" id=\"Commonmacros\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Commonmacros\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h3><h4 data-darkreader-inline-color=\"\" id=\"Macrostocreatetables\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Macrostocreatetables\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h4><h4 data-darkreader-inline-color=\"\" id=\"EVALmacro\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#EVALmacro\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h4><h3 data-darkreader-inline-color=\"\" id=\"Accountcontext\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><a href=\"https://trac.sippysoft.com/trac/wiki/public/InvoiceTemplates#Accountcontext\" title=\"Link to this section\" style=\"color: rgb(215, 215, 215); border-style: none; font-size: 0.8em; --darkreader-inline-color:#dbd8d3;\"></a></h3><ul><li>${I_INVOICE} - Unique invoice identifier</li><li>${I_ACCOUNT} - Unique account identifier</li><li>${USERNAME} - Account name</li><li>${SALUTATION} - Salutation from account preferences. Mr./Mrs.</li><li>${FIRST_NAME} - First name from account preferences</li><li>${LAST_NAME} - Last name from account preferences</li><li>${CURRENCY} - Account base currency</li><li>${STREET_ADDR} - Street address from account preferences</li><li>${POSTAL_CODE} - Postal code from account preferences</li><li>${CITY} - City from account preferences</li><li>${COMPANY_NAME} - Company Name from account preferences. (<strong>starting from 5.1</strong>)</li><li>${COUNTRY} - Country from account preferences</li><li>${STATE} - Province/State from account preferences. (<strong>starting from Sippy 2020</strong>)</li></ul><p><br></p><p><span style=\"font-family: Verdana,Geneva,sans-serif;\"><strong><span style=\"font-size: 16px;\">Macros containing the current invoice information are:</span></strong></span></p><p><br></p><p>${TOTAL_CHARGES} - Total sum of all minute plans and charges from the Service Plan</p><p>${PAYMENTS_AMOUNT} - Amount of payments for the current billing period</p><p>${FORWARD_AMOUNT} - Unpaid amount from the previous period</p><p>${LAST_BILL_AMOUNT} - Amount due from the previous invoice</p><p>${AMOUNT_DUE} - Amount account owes at the end of the billing period. Will contain non-zero values only if the account's balance is below zero.</p><p>${TARIFF_CALLS_PRICE} - Total sum of the calls exceeding the service plan minutes.</p><p>${TARIFF_CALLS_DURATION} - Total billed duration of the calls exceeding the service plan minutes. Format of duration is [hh:]mm:ss.(<strong>starting from 5.1</strong>)</p><p>${PLAN_CALLS_DURATION} - Total billed duration of the calls within the service plan minutes. Format of duration is [hh:]mm:ss.(<strong>starting from 5.1</strong>)</p><p>${ALL_CALLS_DURATION} - Total billed duration of all calls. Format of duration is [hh:]mm:ss.(<strong>starting from 5.1</strong>)</p><p>${ADDITIONAL_CHARGES} - Charges that were applied in the current billing period in addition to the ${TOTAL_CHARGES}</p><p>${BILL_DATE} - Date at the moment of an invoice creation</p><p>${LAST_BILL_DATE} - Date at which the previous invoice was issued</p><p>${TOTAL_DID_CALLS_CHARGES} - Total sum of DID calls charges to the account. (<strong>starting from 5.0</strong>)</p><p><br></p><p><span style=\"font-family: Verdana,Geneva,sans-serif;\"><strong><span style=\"font-size: 16px;\">Tables:</span></strong></span></p><ul><li>${TABLE:service_plan_charges} - Contains all fields from the service_charges database table.</li><li>${TABLE:service_plan_minutes} - Contains all fields from the service_plans database table.</li><li>${TABLE:charges} - Contains all charges applied to the account for the billing period. A table that could include service charges, minute plan fees, DID monthly fee and DID setup fee (<strong>starting from 5.0</strong>). Available fields within the table:</li><li style=\"margin-left: 40px;\">charge_time - date and time of the charge</li><li style=\"margin-left: 40px;\">date - date only part of the charge_time</li><li style=\"margin-left: 40px;\">amount - positive number of the charge applied</li><li style=\"margin-left: 40px;\">currency - currency</li><li style=\"margin-left: 40px;\">name - name of the charge</li><li style=\"margin-left: 40px;\">description - description of the charge</li><li style=\"margin-left: 40px;\">_num - Sequential number of the record</li><li>${TABLE:cdrs} - Contains all fields from the cdrs table plus the following additional fields that should be placed inside the TABLE macros:<ul><li>_num - Sequential number of the record</li><li>date - Date part of the connect_time field</li><li>time - Time part of the connect_time field</li></ul></li></ul><p>\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0<strong>Examples of the macro within\u00a0${TABLE:cdrs}</strong>:</p><ul><li><span style=\"font-family: Verdana;\">${TD:cld_in} - cld_in field<br></span></li><li><span style=\"font-family: Verdana;\">${TD:cost} - cost field</span></li><li><span style=\"font-family: Verdana;\">${TD:duration;fmt=duration} - The 'duration' format displays value in the format [hh:]mm:ss. <strong>Starting from 4.5</strong></span></li><li><span style=\"font-family: Verdana;\">${TD:country} - country from Destinations resolved based on prefix. <span style=\"font-family: Verdana;\"><strong>Starting from Sippy 2020</strong></span></span></li><li><span style=\"font-family: Verdana;\">${TD:description} - Description <span style=\"font-family: Verdana;\">from Destinations resolved based on prefix.<span style=\"font-family: Verdana;\">\u00a0<strong>Starting from Sippy 2020</strong></span></span></span></li></ul><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>The <strong>cdrs</strong> table accepts two optional parameters:</p><ul data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><li>max_rows - Maximum number of CDRs to display in invoice, default is 100</li><li>show_zero_cdrs - Display zero duration CDRs in invoice, default is false</li></ul><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>Examples:</p><ul data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><li>${TABLE:cdrs;max_rows=0} - fetch unlimited number of CDRs</li><li>${TABLE:cdrs;show_zero_cdrs=true;max_rows=10000} - display zero duration cdrs in the invoice, max 10000 records</li></ul><h2 data-darkreader-inline-color=\"\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 16px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><br></h2><h2 data-darkreader-inline-color=\"\" id=\"Macrosubstitutions\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 16px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><span style=\"font-size: 24px; font-family: Verdana,Geneva,sans-serif;\">Macro substitutions</span></h2><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>Invoice template can contain macros. The macros can be of two types - common and context specific.</p><ul><li><h3 data-darkreader-inline-color=\"\" id=\"Commonmacros\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>Common macros</h3></li><li><h4 data-darkreader-inline-color=\"\" id=\"Macrostocreatetables\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><span style=\"font-size: 14px;\">Macros to create tables</span></h4></li></ul><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>To represent a table data there are a macros ${TABLE}, ${TD} and ${TABLE_END} which are designed to be used as shown in the example:</p><p>\u00a0</p><blockquote><p><font size=\"3\">&lt;table&gt;<br>&lt;tr&gt;<br> &lt;th&gt;Call&lt;/th&gt;<br> &lt;th&gt;Date&lt;/th&gt;<br> &lt;th&gt;Time&lt;/th&gt;<br> &lt;th&gt;Number Called&lt;/th&gt;<br>&lt;/tr&gt;&lt;tr&gt;<br> &lt;td&gt;${TABLE:cdrs}&lt;/td&gt;<br>&lt;/tr&gt;&lt;tr&gt;<br> &lt;td&gt;${TD:_num}&lt;/td&gt;<br> &lt;td&gt;${TD:date}&lt;/td&gt;<br> &lt;td&gt;${TD:time}&lt;/td&gt;<br> &lt;td&gt;${TD:cld_in}&lt;/td&gt;<br>&lt;/tr&gt;&lt;tr&gt;<br> &lt;td&gt;${TABLE_END}&lt;/td&gt;<br>&lt;/tr&gt;<br>&lt;/table&gt; </font></p></blockquote><p>All rows between the macros ${TABLE} and ${TABLE_END} are repeated as many times as many rows has to be displayed, and the HTML table rows containing these macros are always skipped and never included in the final document.</p><h4 data-darkreader-inline-color=\"\" id=\"EVALmacro\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'>EVAL macro</h4><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'>With this macro you are allowed to make arbitrary arithmetical calculations and place them on the page in a desired format. The general form for the macro is:</p><blockquote>${EVAL:&lt;expression&gt;[;&lt;format&gt;]}</blockquote><p><br></p><p><span style=\"font-family: Verdana,Geneva,sans-serif;\"><strong><font size=\"3\">Examples:</font></strong></span></p><p data-darkreader-inline-color=\"\" style='color: rgb(0, 0, 0); font-family: Verdana, Arial, \"Bitstream Vera Sans\", Helvetica, sans-serif; --darkreader-inline-color:#e8e6e3;'><span style=\"font-family: Arial;\"><strong><font size=\"2\">Round the result to second digit after the dot:</font></strong></span></p><blockquote><p><span style=\"font-family: Arial;\">${EVAL: ( ${TOTAL_CHARGES} ) ; %.02f }</span></p></blockquote><p><strong><span rel=\"tempredactor\">Perform the division with 3 and round to the second digit after the dot:</span></strong></p><blockquote><p><span style=\"font-family: Arial;\">${EVAL: ( ${LAST_BILL_AMOUNT} / 3.0 ) ; %.02f }</span></p></blockquote><p><strong><span data-darkreader-inline-bgcolor=\"\" data-darkreader-inline-color=\"\" rel=\"tempredactor\" style=\"color: rgb(51, 51, 51); background-color: rgb(255, 255, 255); --darkreader-inline-color:#d6d3cd; --darkreader-inline-bgcolor:#181a1b;\">Some arithmetic operation:</span></strong></p><blockquote>${EVAL: ( ${TD:_num} + 15 ) / 2 }</blockquote><h3 data-darkreader-inline-color=\"\" id=\"Accountcontext\" style='font-family: Arial, Verdana, \"Bitstream Vera Sans\", Helvetica, sans-serif; font-weight: bold; font-size: 14px; color: rgb(0, 0, 0); --darkreader-inline-color:#e8e6e3;'><br></h3><p><strong>To edit invoice template use web applications using direct links:</strong></p><pre data-darkreader-inline-bgcolor=\"\" data-darkreader-inline-color=\"\" style=\"color: rgb(0, 0, 0); background-color: rgb(247, 247, 247); --darkreader-inline-color:#e8e6e3; --darkreader-inline-bgcolor:#1b1c1d;\">/invoice_templates.php\n/images.php</pre><p><br></p><p><font><strong>List of supported formats for the images:</strong></font></p><p><em><strong>JPG, JPEG, PNG, GIF(static)</strong></em></p><p><br></p><p><strong>List of supported fonts:</strong></p><p><em>Sans Serif</em></p><p><em>Monospace</em></p><p><em>Serif</em></p><p><br></p><p><span style=\"font-size: 24px;\"><strong>Custom CSS</strong></span></p><p>Starting from our Sippy 5.0 version Our users can now add their own custom CSS to their own invoice template. \u00a0The Invoice Template will have a field specifically for CSS so you can brand your invoices as needed. \u00a0The style sheet just needs to be copied into the field below. \u00a0A very simple example is provided below and the sample out put is shown.</p><p><br></p><p><img class=\"fr-dib\" src=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3038820330/original/ahROiPVN0jYcdyrXulvsSNW7ISJBDzDezA.PNG?1535733868\" data-filelink=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3038820330/original/ahROiPVN0jYcdyrXulvsSNW7ISJBDzDezA.PNG?1535733868\" data-fileid=\"3038820330\" data-uniquekey=\"1535732764720\">** </p><p><br></p><p style=\"text-align: left;\"><br></p><p><span style=\"font-size: 16px;\">To help you make use of this feature here is the sample Invoice template updated to include a basic style sheet and the resulting invoice template.</span></p><pre class=\"code-large\" contenteditable=\"false\" data-code-brush=\"css\" rel=\"highlighter\">body {\n\u00a0 background-color: #ffffff;\n}\n\nh2 {\n\u00a0 colour: orange;\n\u00a0 background-color: #ff9900;\n\u00a0 border: 1px solid #544f4f;\n}\n\np, em {\n\u00a0 colour: orange;\n\u00a0 background-color: #ff9900;\n\u00a0 border: 1px solid #544f4f;\n}\n\np, li {\n\u00a0 text-decoration: underline;\n}</pre><h2><span style=\"font-family: Helvetica, sans-serif; font-size: 16px;\"><br>Example of the final output:</span></h2><p><img class=\"fr-dib\" src=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3038820228/original/UPDIFV9sSAF9pIvAkT7UWAadJPzderj_Eg.png?1535733556\" data-filelink=\"https://s3.amazonaws.com/cdn.freshdesk.com/data/helpdesk/attachments/production/3038820228/original/UPDIFV9sSAF9pIvAkT7UWAadJPzderj_Eg.png?1535733556\" data-fileid=\"3038820228\" data-uniquekey=\"1535732764720\"></p><p><br></p><p><span style=\"font-size: 24px;\"><strong>Test(validate) Invoice template</strong></span></p><p>Starting from 5.2 version it's possible to generate test invoice based on modified invoice template to see the expected result prior to the billing pass.</p><p>XMLAPI call is used for that purpose, see documentation:</p><p><a href=\"https://support.sippysoft.com/solution/articles/3000080953-xml-rpc-api-testinvoice\" rel=\"noreferrer\">https://support.sippysoft.com/solution/articles/3000080953-xml-rpc-api-testinvoice</a></p>",
  "description_text": " Invoicing  Invoice templates  Invoice templates are the XHTML documents with embedded macros that are converted into the XSL Formatting Objects using the ~ssp/etc/xsl/xhtml2fo.xsl, the slightly modified version of the style sheet from http://antennahouse.com/. The resulting XSL FO document is finally converted into the PDF file using Apache FOP. Starting from Sippy 5.0, version wkhtmltopdf is used as PDF converter.     The invoice templates are stored in the database, table invoice_templates. The templates with the i_invoice_template field values in the 1 to 1000 range are system templates, they are additionally filed as: \u00a0invoice_templates.is_system = True     Invoice templates for accounts  An invoice template is a mandatory attribute of a Service Plan (billing_plans.i_invoice_template). \u00a0The invoice template has a system default value (see below). \u00a0Accounts have optional attributes for invoice templates (accounts.i_invoice_template) which can override the setting from the Service Plan. \u00a0Accounts also have settings to enable the generation of invoices. \u00a0Invoices can be sent via e-mail to addresses specified in the contacts of the Account, filed as: accounts.invoicing_enabled     On the Sippy interface the Account can view the type of invoice which is enabled by checking \"Invoicing Enabled\" in his settings (the sub-Account, after logging in can change it.)     Invoice templates can be chosen from the Invoice Template list after invoicing is enabled. \u00a0  The same could be done using the bulk upload feature for multiple Accounts.     Currently assigned system templates         1 - The default invoice template for accounts    Creating a custom invoice template        It is recommended that you avoid changing the Default invoice template. \u00a0By using the following strategy you'll always keep one Default working invoice template and will be able adjust a custom one on your own.   Log into your switch and open the page which contains a list of all invoice templates. Starting from 5.2 version of Sippy\u00a0the page is available under Customers - Invoicing - Invoice Templates menu, in earlier versions it is hidden, so you need to type \"invoice_templates.php\" manually in your browser's address line. The full link looks as https://11.22.33.44/c1/invoice_templates.php (where 11.22.33.44 is the address or domain name of your switch).  By default, only one template is available called \"Default...\". Open it and copy the HTML content of the Default invoice template into a clipboard or a notepad, or press Add Based on Existing button on Invoice Templates page (starting from 5.2)     Next, go back to the invoice_templates.php page and click \"Add New Invoice Template\".    Open HTML editor again.    Paste the HTML content which you copied at step #2.    Save the template. Now you have a full copy of the Default working invoice template which you can customize on your own.     Available macros list  Starting from 5.0 version of Sippy the list of available macros are accessible from invoice editor:          Macros that contain the attributes of an account:             ${I_INVOICE} - Unique invoice identifier  ${I_ACCOUNT} - Unique account identifier  ${USERNAME} - Account name  ${SALUTATION} - Salutation from account preferences. Mr./Mrs.  ${FIRST_NAME} - First name from account preferences  ${LAST_NAME} - Last name from account preferences  ${CURRENCY} - Account base currency  ${STREET_ADDR} - Street address from account preferences  ${POSTAL_CODE} - Postal code from account preferences  ${CITY} - City from account preferences  ${COMPANY_NAME} - Company Name from account preferences. (starting from 5.1)  ${COUNTRY} - Country from account preferences  ${STATE} - Province/State from account preferences. (starting from Sippy 2020)      Macros containing the current invoice information are:     ${TOTAL_CHARGES} - Total sum of all minute plans and charges from the Service Plan  ${PAYMENTS_AMOUNT} - Amount of payments for the current billing period  ${FORWARD_AMOUNT} - Unpaid amount from the previous period  ${LAST_BILL_AMOUNT} - Amount due from the previous invoice  ${AMOUNT_DUE} - Amount account owes at the end of the billing period. Will contain non-zero values only if the account's balance is below zero.  ${TARIFF_CALLS_PRICE} - Total sum of the calls exceeding the service plan minutes.  ${TARIFF_CALLS_DURATION} - Total billed duration of the calls exceeding the service plan minutes. Format of duration is [hh:]mm:ss.(starting from 5.1)  ${PLAN_CALLS_DURATION} - Total billed duration of the calls within the service plan minutes. Format of duration is [hh:]mm:ss.(starting from 5.1)  ${ALL_CALLS_DURATION} - Total billed duration of all calls. Format of duration is [hh:]mm:ss.(starting from 5.1)  ${ADDITIONAL_CHARGES} - Charges that were applied in the current billing period in addition to the ${TOTAL_CHARGES}  ${BILL_DATE} - Date at the moment of an invoice creation  ${LAST_BILL_DATE} - Date at which the previous invoice was issued  ${TOTAL_DID_CALLS_CHARGES} - Total sum of DID calls charges to the account. (starting from 5.0)     Tables:   ${TABLE:service_plan_charges} - Contains all fields from the service_charges database table.  ${TABLE:service_plan_minutes} - Contains all fields from the service_plans database table.  ${TABLE:charges} - Contains all charges applied to the account for the billing period. A table that could include service charges, minute plan fees, DID monthly fee and DID setup fee (starting from 5.0). Available fields within the table:  charge_time - date and time of the charge  date - date only part of the charge_time  amount - positive number of the charge applied  currency - currency  name - name of the charge  description - description of the charge  _num - Sequential number of the record  ${TABLE:cdrs} - Contains all fields from the cdrs table plus the following additional fields that should be placed inside the TABLE macros:  _num - Sequential number of the record  date - Date part of the connect_time field  time - Time part of the connect_time field     \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Examples of the macro within\u00a0${TABLE:cdrs}:   ${TD:cld_in} - cld_in field   ${TD:cost} - cost field  ${TD:duration;fmt=duration} - The 'duration' format displays value in the format [hh:]mm:ss. Starting from 4.5  ${TD:country} - country from Destinations resolved based on prefix. Starting from Sippy 2020  ${TD:description} - Description from Destinations resolved based on prefix.\u00a0Starting from Sippy 2020   The cdrs table accepts two optional parameters:   max_rows - Maximum number of CDRs to display in invoice, default is 100  show_zero_cdrs - Display zero duration CDRs in invoice, default is false   Examples:   ${TABLE:cdrs;max_rows=0} - fetch unlimited number of CDRs  ${TABLE:cdrs;show_zero_cdrs=true;max_rows=10000} - display zero duration cdrs in the invoice, max 10000 records      Macro substitutions  Invoice template can contain macros. The macros can be of two types - common and context specific.    Common macros    Macros to create tables    To represent a table data there are a macros ${TABLE}, ${TD} and ${TABLE_END} which are designed to be used as shown in the example:  \u00a0   <table> <tr>  <th>Call</th>  <th>Date</th>  <th>Time</th>  <th>Number Called</th> </tr><tr>  <td>${TABLE:cdrs}</td> </tr><tr>  <td>${TD:_num}</td>  <td>${TD:date}</td>  <td>${TD:time}</td>  <td>${TD:cld_in}</td> </tr><tr>  <td>${TABLE_END}</td> </tr> </table>    All rows between the macros ${TABLE} and ${TABLE_END} are repeated as many times as many rows has to be displayed, and the HTML table rows containing these macros are always skipped and never included in the final document.  EVAL macro  With this macro you are allowed to make arbitrary arithmetical calculations and place them on the page in a desired format. The general form for the macro is:  ${EVAL:<expression>[;<format>]}     Examples:  Round the result to second digit after the dot:   ${EVAL: ( ${TOTAL_CHARGES} ) ; %.02f }   Perform the division with 3 and round to the second digit after the dot:   ${EVAL: ( ${LAST_BILL_AMOUNT} / 3.0 ) ; %.02f }   Some arithmetic operation:  ${EVAL: ( ${TD:_num} + 15 ) / 2 }     To edit invoice template use web applications using direct links:  /invoice_templates.php\n/images.php     List of supported formats for the images:  JPG, JPEG, PNG, GIF(static)     List of supported fonts:  Sans Serif  Monospace  Serif     Custom CSS  Starting from our Sippy 5.0 version Our users can now add their own custom CSS to their own invoice template. \u00a0The Invoice Template will have a field specifically for CSS so you can brand your invoices as needed. \u00a0The style sheet just needs to be copied into the field below. \u00a0A very simple example is provided below and the sample out put is shown.     **         To help you make use of this feature here is the sample Invoice template updated to include a basic style sheet and the resulting invoice template.  body {\n\u00a0 background-color: #ffffff;\n}\n\nh2 {\n\u00a0 colour: orange;\n\u00a0 background-color: #ff9900;\n\u00a0 border: 1px solid #544f4f;\n}\n\np, em {\n\u00a0 colour: orange;\n\u00a0 background-color: #ff9900;\n\u00a0 border: 1px solid #544f4f;\n}\n\np, li {\n\u00a0 text-decoration: underline;\n}   Example of the final output:       Test(validate) Invoice template  Starting from 5.2 version it's possible to generate test invoice based on modified invoice template to see the expected result prior to the billing pass.  XMLAPI call is used for that purpose, see documentation:  https://support.sippysoft.com/solution/articles/3000080953-xml-rpc-api-testinvoice ",
  "seo_data": {
    "meta_title": "",
    "meta_description": "",
    "meta_keywords": ""
  },
  "tags": [
    "invoice",
    "macro",
    "Web"
  ],
  "attachments": [],
  "cloud_files": [],
  "thumbs_up": 5,
  "thumbs_down": 9,
  "hits": 3998,
  "suggested": 0,
  "feedback_count": 0,
  "collaboration": {
    "convo_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJUeXBlIjoiYXJ0aWNsZSIsIkNvbnZvSWQiOiIzMDAwMDE0MTc5LWVuIiwiVXNlcklkIjoiMzAxMjA4OTUyNCIsImV4cCI6MTYzNTM3MDk5OX0.hOZVu5rOZimvLSVwptUR5NOnIt6tjt_MZtJtRmnGX14"
  }
}