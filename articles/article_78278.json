{
  "id": 78278,
  "type": 1,
  "status": 2,
  "agent_id": 3763909,
  "created_at": "2013-04-23T09:43:45Z",
  "category_id": 82218,
  "folder_id": 134765,
  "title": "Calling Card IVR Application",
  "updated_at": "2020-03-31T18:47:33Z",
  "description": "<div><div dir=\"ltr\"><h3><span style=\"font-size: 18px;\">Setting up DID for Calling Card IVR Application</span></h3><p><br></p><ol><li>Add an IVR Application of type 'Calling Card' in 'IVR Applications' menu on the Web. After creation of the application use Advanced Parameters to customize the application for your needs.</li><li>Use the 'DID Pool' menu to add a DID and assign your newly created Calling Card IVR Application to it.</li></ol><p><br></p><h3><span style=\"font-size: 18px;\">Call routing setup (obsolete)</span></h3><p><br></p><ol><li>Add vendor connection. Set the Asterisk's host/port in the Destination field of Vendor Connection (ex: 192.168.0.100:5062).</li><li>Set the CLD Translation Rule for the connection to the value s/.*/callingcard/. Optionally the set of options can be specified in the CLD - see the specs below.</li><li>Add route to this connection and specify the Calling Card Extension number.</li></ol><p><br></p><h3><span style=\"font-size: 18px;\">Configuration options</span></h3><p><strong><br></strong></p><p dir=\"ltr\"><strong>Basic options:</strong></p><br><table class=\"current\" id=\"table77886\"><tbody><tr><td><b class=\"current\">Option<br></b></td><td>Meaning<br></td><td>Default</td></tr><tr><td><strong>Announce Balance</strong></td><td>Whether to announce balance upon successful start of application</td><td>Yes<br></td></tr><tr><td><b class=\"current\"><br>Normal Calls Are Allowed</b></td><td><br>Only service codes enabled if this option is False<br>No outgoing calls will be processed by this CC IVR application while only the Service Codes will be processed if that option option set to 'false' .<br></td><td><br>True</td></tr><tr><td><strong>Disconnect On Failure</strong></td><td>Whether to drop the Calling Card session upon unsuccessful call attempt. Otherwise the application announces that the failure occurred and offers the user to enter another destination.</td><td>No<br></td></tr><tr><td><strong>Allow Empty PIN</strong></td><td>Whether to permit to use the prepaid card accounts with empty PIN</td><td>true</td></tr><tr><td><strong>Preserve Original CLI</strong></td><td>CLI from the initial call leg will be used to call destination if this option set to true. The calling card username will be used as CLI otherwise.</td><td>false<br></td></tr><tr><td><strong>Maximum Call Duration</strong></td><td>Maximum call duration</td><td>3600 seconds<br></td></tr><tr><td><strong>Card Number Length</strong></td><td>Maximum number of digits allowed in a card number</td><td>10<br></td></tr><tr><td><strong>Number_Of_Attempts_To_Enter_A_Card</strong></td><td>Maximum number of attempts to enter card number or PIN code</td><td>3<br></td></tr><tr><td><strong>Number Of Wrong Destinations</strong></td><td>Maximum allowed number of unsuccessful call attempts in a row</td><td>3<br></td></tr><tr><td><strong>Number Of Timeouts</strong></td><td>Maximum number of input timeouts</td><td>3<br></td></tr><tr><td><strong>Minimum Call Duration</strong></td><td>Minimum allowed call duration (in seconds). If calculated maximum duration of the call to the requested destination is less than this value then the user will hear the prompt \"You have insufficient funds to make this call\"</td><td>10<br></td></tr><tr><td><strong>Minimum Card Number Length</strong></td><td>Minimum number of digits allowed in a card number</td><td><br></td></tr><tr><td><strong>No Seconds In Duration</strong></td><td>Do not pronounce seconds while announcing call duration. If the duration is less than 1 minute then this option is ignored.</td><td>False<br></td></tr><tr><td><strong>No Hours In Duration</strong></td><td>Do not speak out hours while announcing call duration, only minutes</td><td>False<br></td></tr><tr><td><strong>Announce Duration</strong></td><td>Should the duration of the call be announced</td><td>True<br></td></tr><tr><td><strong>Call Several Destinations</strong></td><td>Only one call attempt per session is allowed if this option is False. Equal to <b class=\"current\">noredial\u00a0</b><span class=\"current\">option</span><b class=\"current\"><br></b></td><td>True<br></td></tr><tr><td><strong>Outbound SIP Proxy</strong></td><td>SIP proxy host:port to send the outbound calls to (this option can also be set from the command line).<br><p class=\"current\">This option can be useful if the outgoing calls should be processed by the external switch\\server instead of the built-in b2bua service for placing the outbound calls to your Vendors.</p></td><td>&lt;Environment_IP&gt;:5061</td></tr><tr><td><strong>Disconnect Warning Time</strong></td><td>Say \u00a0<strong><em>'Your call will be disconnected in N seconds'\u00a0</em>\u00a0</strong>before the call disconnect</td><td>60<br></td></tr><tr><td><strong>Play Service Plan Minutes Only</strong></td><td>Play service plan minutes instead of a sum of plan minutes and duration calculated by tariff. This option does not affect actual maximum duration of a call which is a sum of plan minutes and duration calculated by tariff.</td><td>False</td></tr><tr><td><strong>Destination Number Completion Regex</strong></td><td>Treat the destination number to have been completed and immediately continue with the call when the input matches the given regular expression pattern</td><td><br></td></tr><tr><td><strong>The Reason For Diversion *</strong><br></td><td>The reason parameter for the Diversion SIP header<br></td><td>unconditional<br></td></tr></tbody></table><p><span style=\"font-size: 14px;\">* starting from Sippy 2020</span></p><p><br></p><h3><span style=\"font-size: 18px;\">Trusted CLI related options</span></h3><p><br></p><table id=\"table68374\"><tbody><tr><td><strong>Option</strong><br></td><td><strong>Meaning</strong><br></td><td><strong>Default</strong></td></tr><tr><td><strong>Enable CLI Registration</strong></td><td>If the 'CLI Registration' sub application is enabled, then the corresponding IVR prompt will be played and the user will be asked to link its &lt;ANI\\CLI&gt; number as the 'Trusted Number' to the used &lt;Calling Card\\PIN&gt; for further possible PINless dialing.<br><br></td><td><br></td></tr><tr><td><strong>Automatic CLI Registration</strong></td><td>After calling card has been entered successfully, add the current CLI to the list of trusted CLIs for this calling card. If the authorization is successful after entering the &lt;Calling Card\\PIN&gt;, then the user's &lt;ANI\\CLI&gt; number will be added as the 'Trusted Number' to the used &lt;Calling Card\\PIN&gt; for further possible PINless dialing.</td><td><br>No<br></td></tr><tr><td><strong>Silent Automatic CLI Registration</strong></td><td class=\"current\">When this option is set to False the user will be prompted if he wishes to register his phone number (new in 1.7.1).<br>The same as in Automatic CLI Registration, but the user will be asked whether its number should be added as the 'Trusted Number' to the used &lt;Calling Card\\PIN&gt; for further possible PINless dialing<br></td><td>True<br></td></tr><tr><td><strong>CLI Registration Menu Extension Number</strong></td><td>Extension number for the CLI Registration Subapplication. Exact extension number that can be entered to reach the CLI Registration Sub application while connected to that CC IVR application.</td><td>any value from 0 to 9<br></td></tr><tr><td><b class=\"current\">Trusted CLI Authentication</b></td><td>Allow to use Trusted Numbers for authentication.</td><td>False<br></td></tr><tr><td><strong>Minimum Valid CLI Length</strong></td><td>Minimum CLI length that is allowed to trigger the Automatic CLI Registration.</td><td>6<br></td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Password change</span></h3><p><br></p><table id=\"table94866\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong><br></td><td><strong>Default</strong></td></tr><tr><td><strong>Enable Password Change</strong></td><td>If password change enabled<br></td><td>True</td></tr><tr><td><b class=\"current\"><br>Change Password Menu Extension Number<br></b></td><td><br>Extension number for the Change Password Subapplication.<br></td><td class=\"current\"><br>any value from 0 to 9<br></td></tr></tbody></table><span style=\"font-size: 18px;\"><br>Billing related options</span>:<br><br><table id=\"table85550\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><strong>Balance Threshold</strong></td><td>If the balance of the card is below this threshold then the card number will be asked even if CLI authentication is successful. <em>Please note that this option doesn't disable cards with the balance below threshold, it just forces the PIN to be entered despite the fact the CLI authentication was successful. If you want to disable cards with low balance, please use the Minimum Balance option.</em> (new in 1.8)</td><td>The value of the <strong>Minimum Balance</strong> option</td></tr><tr><td><strong>Minimum Balance</strong></td><td>If the balance of the card becomes less than the specified value then the card becomes unavailable. The balance can be specified with or without currency. Currency may follow the balance value, ex: '2 USD'. When no currency specified then the balance checked as an absolute value regardless of card's currency (updated in 1.7.1)</td><td>NULL</td></tr><tr><td><strong>Ignore Connect Fee</strong></td><td>Do not use connect_fee in the duration calculations</td><td>False<br></td></tr><tr><td><strong>Say_Negative_Balance_As_Zero</strong></td><td class=\"current\">When option is and if balance is under zero then say \"You have zero dollars\". Say \"You have minus &lt;amount&gt; dollars\" if this option disabled.<br></td><td>True<br></td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Authentication</span></h3><p><br></p><table id=\"table59771\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><b class=\"current\">Use CLI Authentication Only</b></td><td>Only accounts with existing CLI mapping are allowed to enter. IVR system will authorize incoming calls by trust CLI method.</td><td>False<br></td></tr><tr><td><b class=\"current\">CLI As Card Number</b></td><td>Try to use CLI as card number first before other methods</td><td>False<br></td></tr><tr><td><strong>Use VoIP Login As Card Number</strong></td><td>Look for a calling card in the accounts table by the authname field (normally the username field is used).</td><td>False</td></tr><tr><td><b class=\"current\">PIN-less CLI Authentication</b></td><td>Option applicable for any IVR application since 4.4, if any kind of CLI authentication has succeeded then do not ask for PIN even if it is set. The CLI authentication includes <b style=\"line-height: 1.3;\">CLI As Card Number, Trusted Numbers\u00a0</b><span style=\"line-height: 1.3;\">and<b class=\"current\">\u00a0Smart Dial</b><span class=\"current\">.</span></span></td><td>False<br></td></tr><tr><td><strong>Allow Own Accounts Only</strong></td><td>Option applicable for any IVR application since 4.4, if enabled then only accounts of the customer that has created this IVR application would be allowed to use it.<br></td><td class=\"current\">False</td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Custom scripts:</span></h3><br><table id=\"table58107\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><b class=\"current\">Custom Script To Check Destination</b></td><td class=\"current\">Set the path to the destination check script.<br>Destination Check Script - is a Python script. The script is to be put into some file (/home/ssp/check_dest.py for example) and path to this script is to be added to the configuration. This file has to contain the function checkDestination() with six mandatory parameters - CLI, translated CLI, CLD, translated CLD, username of account making the call and original CLI of the IVR session. The function must return boolean value where True means that the destination is allowed and False - destination is prohibited. Script is loaded dynamically so there is no need to restart ivrd after the script has been changed. Should any problem occur during script load, the script is disabled and corresponding error message is written to the log. If any problem occur during script execution, the Calling Card application treats this as a prohibition to make call.<br></td><td><br></td></tr><tr><td><strong>Custom Script To Change Announced Duration</strong></td><td>Script to calculate custom duration to be announced to the user. Duration Script - The script is run with the following parameters: account's username, account's balance, CLI, CLD, calculated maximum duration (in seconds), i_tariff, translated CLI and translated CLD. The script must print to the stdout a duration that is to be announced to the user. Please note that the duration returned from the script does not affect the maximum session time, it only changes the duration announcement message.</td><td><br></td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Hot Dial &amp; Smart Dial</span></h3><br><table id=\"table6261\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><strong>Enable Direct Hot Dial</strong></td><td>Single digit destinations dialed from main menu will be treated as hot dial keys if this option is true</td><td>False<br></td></tr><tr><td><strong>Enable Hot Dial</strong></td><td>If the Hot Dial subapplication enabled. Enable Direct Hot Dial option is applied for accounts which use Hot Dial feature.<br>In this case, single digit destinations dialed from main menu will be treated as hot dial keys.<br>For example account uses Hot Dial Key 5 with Destination number 123456. Pressing 5# in Calling<br>Card IVR initiates call to the 123456 destination if Enable Direct Hot Dial = True and returns error<br>if Enable Direct Hot Dial = false (by default).<br></td><td>True<br></td></tr><tr><td><strong>Hot Dial Edit Menu Extension</strong></td><td>Extension number to edit the Hot Dial keys</td><td><br></td></tr><tr><td><strong>Hot Dial Menu Extension</strong></td><td>Hot Dial extension number</td><td><br></td></tr><tr><td><strong>Limit Hot Keys</strong></td><td>If true then only keys 1, 2 and 3 can act as the hot dial keys</td><td>False<br></td></tr><tr><td><strong>Smart Dial Exclusive Mode</strong></td><td>Should the Smart Dial DID be shared amongst many accounts.<br><p class=\"current\">This option should be left false by default. If it is set to true, only 1 account will be able to add DID number assigned to this IVR application as Smart Dial number.</p></td><td>False<br></td></tr></tbody></table><p><br></p><h3><br></h3><h3><span style=\"font-size: 18px;\">Top-Up</span></h3><br><table id=\"table73856\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><strong>Enable Top-Up feature</strong></td><td>If the Topup subapplication enabled</td><td>True<br></td></tr><tr><td><strong>Top-Up Card Length</strong></td><td>The maximum allowed number of digits of top-up card \u00a0<br></td><td>10<br></td></tr><tr><td><strong>Top Up Menu Extension</strong></td><td class=\"current\">Extension number for Top-Up Card Subapplication.<br><br></td><td>any value from 0 to 9<br></td></tr></tbody></table><span style=\"font-size: 18px;\"><br>Black List</span><p><br></p><p dir=\"ltr\"><em>Please note that attempts to enter numbers less than 4 digits long are not treated as fraud activity. Only numbers more than 3 digits long trigger black list.</em></p><br><table id=\"table99682\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><strong>Enable Black List</strong></td><td>If the blacklist feature turned on.</td><td>False</td></tr><tr><td><strong>Number Of Attempts To Blacklist</strong></td><td>How many wrong calling card numbers should be entered in a row to blacklist the current CLI.</td><td>3<br></td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Miscellaneous</span></h3><p><br></p><table id=\"table17074\"><tbody><tr><td><strong>Option</strong></td><td><strong>Meaning</strong></td><td><strong>Default</strong></td></tr><tr><td><strong>Use Word PIN</strong></td><td class=\"current \">Enable one-step authentication. With the <strong>Use Word Pin</strong> option set to false the <strong>PIN\u00a0</strong>would be asked after entering the card number for accounts that have PIN configured. Case PIN is not set for Account, authentication will proceed without it, unless <strong>Allow Empty PIN</strong> is set to false, in such case call would be dropped with PIN set request.<br>Thus if you need to add extra security to the system, setting this parameter to False would be a good idea, as it'd require entering both card number and a secret <strong>PIN</strong> of that card.<br>Also applicable to <strong>Top-Up IVR</strong> application, to enable top-up vouchers <strong>PINs</strong>.<br>Use word <strong>PIN\u00a0</strong>in all phrases regarding card number. So for example phrase <strong>\"Enter card number\"</strong> will sound <strong>\"Enter PIN code\"</strong> and so on... <em>Please note that this option disables the password check</em>.</td><td>True<br></td></tr><tr><td><strong>Suppress Pound Phrase</strong></td><td>Do not say \"...followed by the pound key\" when asking destination number and PIN</td><td>False<br></td></tr><tr><td><strong>Enable Custom Greeting</strong></td><td>If the custom language independent greeting enabled (it is played at the very beginning of the application before the language selection)</td><td>No<br></td></tr><tr><td><strong>Custom Greeting File</strong></td><td>Path to the custom language independent greeting audio file (it is played at the very beginning of the application before the language selection). Path has to be specified omitting the file extension, in the same folder there must be versions for all needed extensions (sln, g729, possibly g723). Example:<br>/usr/home/ssp-root/my_custom_prompt<br></td><td><br></td></tr><tr><td><strong>Early Greeting Prompt ID</strong></td><td>The Prompt ID to be played before the language selection menu. This prompt cannot be localized. See an example at the end of the page. This option let you use the custom greeting when you're calling to the IVR app.<br></td><td><br></td></tr><tr><td><strong>Late Greeting Prompt ID</strong></td><td>The Prompt ID to be played after the language selection menu before balance announcement. This prompt can be localized. See an example at the end of the page.</td><td><br></td></tr><tr><td><strong>VoodooVox Source Key</strong></td><td>The source key for VoodooVox Ads</td><td>None<br></td></tr><tr><td><strong>Default Calling Card Language</strong></td><td>Default fall back language</td><td>en<br></td></tr><tr><td><strong>Fallback_To_Default_Calling_Card_Language</strong></td><td>Whether to fall back to default language after the maximum number of wrong attempts to select the language have been made.</td><td>No<br></td></tr><tr><td><strong>Say 'No Card' On Low Balance</strong></td><td>Say \"<strong><em>Wrong card number (PIN code)</em>\"</strong> instead of <em><strong>\"There is no available balance left in this calling card\"</strong></em>. (New in 3.0)</td><td>True<br></td></tr></tbody></table><p><br></p><h3><span style=\"font-size: 18px;\">Destination Check Script</span></h3><p><br></p><p dir=\"ltr\">This is a Python script in the following format. The script is to be put into some file (/home/ssp/check_dest.py for example) and path to this script is to be added to the configuration. This file has to contain the function checkDestination() with six mandatory parameters - CLI, translated CLI, CLD, translated CLD, username of account making the call and original CLI of the IVR session. The function must return boolean value where True means that the destination is allowed and False - destination is prohibited. This script is loaded dynamically so there is no need to restart ivrd after the script has been changed. Should any problem occur during script load, the script is disabled and corresponding error message is written to the log. If any problem occur during script execution, the Calling Card application treats this as a prohibition to make call.</p><p><br></p><h3><span style=\"font-size: 18px;\">Duration Script</span></h3><p dir=\"ltr\"><br>The script is run with the following parameters: account's username, account's balance, CLI, CLD, calculated maximum duration (in seconds), i_tariff, translated CLI and translated CLD. The script must print to the stdout a duration that is to be announced to the user. Please note that the duration returned from the script does not affect the maximum session time, it only changes the duration announcement message.</p><p><br></p><h3><span style=\"font-size: 18px;\">Database usage</span></h3><p dir=\"ltr\"><br>The application uses the <strong>accounts\u00a0</strong>table for authentication purposes, to retrieve the value of the user's balance, to make balance transfers and to change password.<br><br>The <strong>calling_card_cli</strong>_map table is used to store CLI-to-CallingCard mappings. These mappings are used to automatically select the calling card account based on the CLI of the user.</p><p><br></p><h3><span style=\"font-size: 18px;\">Use of multiple instances of Calling Card Application</span></h3><p dir=\"ltr\"><br>The application can be configured not only via central configuration but also by CLD rewriting. This allows to use several differently configured instances of application within the same server. The CLD options always override the corresponding global configuration options.<br><br>The following parameters are accepted.</p><p><br></p><table id=\"table62825\"><tbody><tr><td><strong>chpassext&lt;ext&gt;</strong></td><td>Specify the Change Password extension for this instance</td></tr><tr><td><strong>cliregext&lt;ext&gt;</strong></td><td>Specify the CLI Registration extension for this instance</td></tr><tr><td><strong>directhotdial</strong></td><td>Destinations 1, 2 and 3 dialed from main menu will be treated as hot dial keys if this option is specified</td></tr><tr><td><strong>earlymedia</strong></td><td>Use early media mode till the destination has answered</td></tr><tr><td><strong>greet&lt;i_ivr_prompt&gt;</strong></td><td>Use prompt from the <em>ivr_prompts</em> table as a greeting (new in 1.7)</td></tr><tr><td><strong>hotdialext&lt;ext&gt;</strong></td><td>Hot Dial extension number</td></tr><tr><td><strong>hotdialeditext&lt;ext&gt;</strong></td><td>Extension number to edit Hot Dial keys</td></tr><tr><td><strong>keepcli</strong></td><td>Use original CLI to call destination</td></tr><tr><td><strong>lgreet&lt;i_ivr_prompt&gt;</strong></td><td>Use prompt from the <em>ivr_prompts</em> table as a late greeting. This greeting is language aware, unlike the <strong>greet</strong> option (new in 1.7).</td></tr><tr><td><strong>nocardenter</strong> or <strong>climaponly</strong></td><td>Exit immediately if no CLI mapping has been found</td></tr><tr><td><strong>nochpass</strong></td><td>Change Password extension is disabled regardless if it specified or not</td></tr><tr><td><strong>nocliauth</strong></td><td>Do not try to use CLI as card number</td></tr><tr><td><strong>noclireg</strong></td><td>CLI Registration extension is disabled regardless if it specified or not</td></tr><tr><td><strong>nodial</strong></td><td>Disallow outside calls. This is useful if service codes only are to be available.</td></tr><tr><td><strong>nohotdial</strong></td><td>Disable Hot Dial fetature, both dial and edit keys capabilities</td></tr><tr><td><strong>nokeepcli</strong></td><td>Use calling card username as CLI to call destination</td></tr><tr><td><strong>noplaybalance</strong> or <strong>nobalance</strong></td><td>Disallow balance announcement</td></tr><tr><td><strong>noplayduration</strong> or <strong>noduration</strong></td><td>Disable call duration limit announcement</td></tr><tr><td><strong>noredial</strong></td><td>Hangup after the call attempt regardless it was successful or not</td></tr><tr><td><strong>notopup</strong></td><td>Top-Up extension is disabled regardless if it specified or not</td></tr><tr><td><strong>planminutes</strong></td><td>Play service plan minutes instead of a sum of plan minutes and duration calculated by tariff. This option does not affect actual maximum duration of a call which is a sum of plan minutes and duration calculated by tariff.</td></tr><tr><td><strong>playbalance</strong></td><td>Allow balance announcement</td></tr><tr><td><strong>topup</strong></td><td>Start <a href=\"http://support.sippysoft.com/solution/categories/82218/folders/134765/articles/79046-top-up-card-ivr-subapplication-of-calilng-card-application\" target>Top-Up Card subapplication</a> instead of main Calling Card loop. All functionality except Top-Up Card is disabled.</td></tr><tr><td><strong>topupext&lt;ext&gt;</strong></td><td>Specify the Top-Up extension for this instance</td></tr><tr><td><strong>trustcli</strong></td><td class=\"current\">CLI mapping is trusted so the PIN is never asked</td></tr><tr><td><strong>trycliauth</strong> or <strong>cliauth</strong></td><td>Try to use CLI as card number first before other methods</td></tr></tbody></table><p><br></p><p dir=\"ltr\">All other two-character parameters are treated as language list specification.</p><p dir=\"ltr\">Example of CLD rewriting rule:</p><p><br></p><table id=\"table49544\"><tbody><tr><td><pre>s/.*/callingcard_en_th_ru_cliregext003_trustcli_noplaybalance/</pre></td></tr></tbody></table><p><br></p><em>The balance of account won't be played in the following cases:</em><br><ul><li>there is a minutes plan configured in the service plan of the account</li><li>service plan status is suspended</li><li>account's balance is equal to zero</li></ul><p><br></p><h2>Late Greeting example (new in 1.7)</h2><p><br></p><p dir=\"ltr\">Late Greeting <strong>lgreet</strong> feature allows to make \u00a0announcement after calling card has been identified and before the \u00a0balance played. To play the audio the IVR Prompts facility is used. The \u00a0facility allows to specify a language specific versions of the prompt. \u00a0Here is how one can prepare a prompt to work as a Late Greeting:</p><p><br></p><p dir=\"ltr\">\u00a0- Create a prompt with the default audio recording:</p><p><br></p><table id=\"table55521\"><tbody><tr><td><pre>$ /home/ssp/scripts/ivr_prompt_utils -c default_audio.sln late_greeting 'Long description'\nNew prompt created with i_ivr_prompt = 29</pre></td></tr></tbody></table><p><br></p><p dir=\"ltr\">\u00a0- As you see the prompt created and was assigned an identifier of 29. Add \u00a0all needed localized recodings to this prompt (Thai and \u00a0</p><p dir=\"ltr\">\u00a0 Chinese are \u00a0showed in the following example):</p><p><br></p><table id=\"table20601\"><tbody><tr><td><pre>$ /home/ssp/scripts/ivr_prompt_utils -u 29 -a thai_audio.sln --lang=th\nIVR prompt updated\n$ /home/ssp/scripts/ivr_prompt_utils -u 29 -a chinese_audio.sln --lang=zh\nIVR prompt updated</pre></td></tr></tbody></table><p><br></p><p dir=\"ltr\">\u00a0- Now you've prepared the prompt and can start to use it. Modify your CLD translation rule to include <strong>lgreet29</strong>. So the final rule</p><p dir=\"ltr\">\u00a0 \u00a0may look like:</p><p><br></p><table id=\"table2811\"><tbody><tr><td><pre>s/.*/callingcard_en_th_zh_ja_lgreet29/</pre></td></tr></tbody></table><p><br></p><p dir=\"ltr\">- As you see the Japan and English languages are included here \u00a0also but we haven't prepared the corresponding localized prompts.</p><p dir=\"ltr\">\u00a0 In \u00a0this example the users of the Calling Card that have chosen Japan or \u00a0English will hear the announcement in the default \u00a0</p><p dir=\"ltr\">\u00a0 language (the audio \u00a0from the default_audio.sln file).</p><p><br></p><p dir=\"ltr\">- Please note that the *.sln files must contain audio in \u00a0signed linear format. Almost any audio format can be relatively easily</p><p dir=\"ltr\">\u00a0 converted to the signed linear format. Here is an example how to covert \u00a0'file.wav' into 'file.sln':</p><p><br></p><table id=\"table72495\"><tbody><tr><td>/usr/local/bin/sox file.wav -t raw -s -2 -r8000 -c1 file.sln</td></tr></tbody></table><p><br></p><h2>Notes</h2><p><br></p><p dir=\"ltr\">An i_environment must be specified since version 3.0 in a form:</p><p><br></p><table id=\"table14432\"><tbody><tr><td><pre>ivr_prompt_utils.py -E I_ENVIRONMENT -c audio_file name description</pre></td></tr></tbody></table><p><br></p><h2>Early Greeting example (new in 1.7)</h2><p><br></p><p dir=\"ltr\">Early Greeting <strong>greet</strong> feature allows to make \u00a0announcement before the user proposed to choose a language. The \u00a0procedure of setting up the greeting is very similar to the Late \u00a0Greeting except the language specific audio is not needed. Here is how \u00a0to prepare a prompt to work as an Early Greeting:</p><p><br></p><ul><li>Create a prompt with the default audio recording:</li></ul><p><br></p><table id=\"table17578\"><tbody><tr><td><pre>$ /home/ssp/scripts/ivr_prompt_utils -c greet_audio.sln early_greeting 'This is an early prompt'\nNew prompt created with i_ivr_prompt = 30</pre></td></tr></tbody></table><p><br></p><ul><li>The prompt is ready. Modify your CLD translation rule to include <strong>greet30</strong>. So the final rule may look like:</li></ul><p><br></p><table id=\"table34519\"><tbody><tr><td><pre>s/.*/callingcard_en_th_zh_ja_greet30/</pre></td></tr></tbody></table><p><br></p><h2>Notes</h2><br><ul><li>CLI Registration extension relies on correct CLI delivery to the \u00a0application. Sometimes the CLI is not delivered correctly, or when PSTN \u00a0user blocks his CLI some bogus CLI is delivered instead. This may \u00a0result in user registering this bogus CLI and other users not being able \u00a0to use the service when they also have CLI disabled. Therefore routing \u00a0shall be configured to block any suspicious CLI, for example the \u00a0following CLI Translation Rule could be used to only pass 10-digits \u00a0numeric CLIs that start with 0:</li></ul><p><br></p><table id=\"table2597\"><tbody><tr><td><pre>\u00a0 \u00a0s/(^0[0-9]{9,9}$|^).*$/\\1/</pre></td></tr></tbody></table><br><ul><li><p>\u00a0</p><pre class=\"code-large\" contenteditable=\"false\" rel=\"highlighter\">Calling Card application allows the user to disconnect outgoing call by pressing pound sign twice in a row (##) \u00a0during any phase of the call.\n\nIf you want to deny some CLI \u00a0the possibility of adding itself to the trusted numbers (someone calls to the DID, that is assigned to Calling card IVR application in our system, authorize using some account \"Please, enter your PIN code\" and then can be prompted whether he wants to add the number he calls from as a trusted one) you'll have to do the following:\n\n1. Find out the CLI you want to ban\n2. Add the CLI translation rule to the specific DID number you want to be affected by the change, e.g. to ban CLI 33nonymous from adding it as a trusted one you'll need to add the following translation rule:\ns/^33nonymous$/Anonymous/\n\nAs a result if the incoming CLI = 33nonymous it'll be rewritten to Anonymous, which is not allowed to save itself to the trusted numbers by default.\nNo other CLI will be affected by this change.</pre><p>\u00a0</p></li></ul><strong><font size=\"4\"><br></font></strong><hr><strong><font size=\"4\"><br>Calling Card options explanation</font></strong><br><p><br></p><hr><blockquote dir=\"ltr\">1.Normal Calls Are Allowed<br>\u00a0Only service codes enabled if this option is False</blockquote><p dir=\"ltr\">No outgoing calls will be processed by this CC IVR application while \u00a0only the Service Codes will be processed if that option option set to \u00a0'false' .</p><hr><blockquote><p dir=\"ltr\">2. Outbound SIP Proxy</p></blockquote><blockquote dir=\"ltr\">SIP proxy host:port to send the outbound calls to (this option can also be set from the command line)</blockquote><p dir=\"ltr\">This option can be useful if the outgoing calls should be processed by \u00a0the external switch\\server instead of the built-in b2bua service for \u00a0placing the outbound calls to your Vendors.</p><hr><blockquote dir=\"ltr\">3. Enable CLI Registration<br>\u00a0If the CLI Registration sub application enabled</blockquote><p dir=\"ltr\">If the 'CLI Registration' sub application is enabled, then the \u00a0corresponding IVR prompt will be played and the user will be asked to \u00a0link its &lt;ANI\\CLI&gt; number as the 'Trusted Number' to the used \u00a0&lt;Calling Card\\PIN&gt; for further possible PINless dialing.</p><hr><blockquote dir=\"ltr\">4 Automatic CLI Registration<br>\u00a0After calling card has been entered successfully, add the current CLI to the list of trusted CLIs for this calling card.</blockquote><p dir=\"ltr\">If the authorization is successful after entering the &lt;Calling \u00a0Card\\PIN&gt;, then the user's &lt;ANI\\CLI&gt; number will be added as \u00a0the 'Trusted Number' to the used &lt;Calling Card\\PIN&gt; for further \u00a0possible PINless dialing.</p><hr><blockquote dir=\"ltr\">5.Silent Automatic CLI Registration<br>\u00a0When this option is set to False the user will be prompted if he wishes to register his phone number (new in 1.7.1).</blockquote><p dir=\"ltr\">The same as in 4th case, but the user will be asked whether its number \u00a0should be added as the 'Trusted Number' to the used &lt;Calling \u00a0Card\\PIN&gt; for further possible PINless dialing</p><hr><blockquote dir=\"ltr\">6 CLI Registration Menu Extension Number<br>\u00a0Extension number for the CLI Registration Sub application</blockquote><p dir=\"ltr\">Exact extension number that can be entered to reach the CLI Registration \u00a0Sub application while connected to that CC IVR application.</p><hr><blockquote dir=\"ltr\">7 Trusted CLI Authentication<br>\u00a0CLI mapping is trusted so the PIN is never asked</blockquote><p dir=\"ltr\">That option enables the PINless dialing based on the Trusted Number. If \u00a0the user has already entered the &lt;Calling Card\\PIN&gt; successfully \u00a0during the previous session and its &lt;ANI\\CLI&gt; has been added to \u00a0the Trusted Numbers of the used &lt;Calling Card\\PIN&gt; and if that \u00a0user calls the CC IVR application second time using the same \u00a0&lt;ANI\\CLI&gt;, then no PIN will be asked (no authorization) in such \u00a0case, so that it will be only asked for the destination number to call.</p><hr><blockquote dir=\"ltr\">8. Use CLI Authentication Only<br>\u00a0Only accounts with existing CLI mapping are allowed to enter</blockquote><p dir=\"ltr\">You IVR system will authorize IVR call only by trust CLI method.</p><hr><blockquote dir=\"ltr\">9. Custom Script To Check Destination<br>Set the path to the destination check script</blockquote><p dir=\"ltr\"><strong>Destination Check Script</strong> - This is a Python script in the following \u00a0format. The script is to be put into some file (/home/ssp/check_dest.py \u00a0for example) and path to this script is to be added to the \u00a0configuration. This file has to contain the function checkDestination() \u00a0with six mandatory parameters - CLI, translated CLI, CLD, translated \u00a0CLD, username of account making the call and original CLI of the IVR \u00a0session. The function must return boolean value where True means that \u00a0the destination is allowed and False - destination is prohibited. This \u00a0script is loaded dynamically so there is no need to restart ivrd after \u00a0the script has been changed. Should any problem occur during script \u00a0load, the script is disabled and corresponding error message is written \u00a0to the log. If any problem occur during script execution, the Calling \u00a0Card application treats this as a prohibition to make call.</p><hr><blockquote dir=\"ltr\">10 Custom Script To Change Announced Duration<br>\u00a0Script to calculate custom duration to be announced to the user.</blockquote><p dir=\"ltr\">Duration Script - The script is run with the following parameters: \u00a0account's username, account's balance, CLI, CLD, calculated maximum \u00a0duration (in seconds), i_tariff, translated CLI and translated CLD. The \u00a0script must print to the stdout a duration that is to be announced to \u00a0the user. Please note that the duration returned from the script does \u00a0not affect the maximum session time, it only changes the duration \u00a0announcement message.</p><hr><blockquote dir=\"ltr\">11 Enable Direct Hot Dial<br>\u00a0Single digit destinations dialed from main menu will be treated as hot dial keys if this option is true</blockquote><p dir=\"ltr\">Enable Direct Hot Dial option is applied for accounts which use Hot Dial \u00a0feature. In this case, single digit destinations dialed from main menu \u00a0will be treated as hot dial keys. For example account uses Hot Dial Key 5 \u00a0with Destination number 123456. Pressing 5# in Calling Card IVR \u00a0initiates call to the 123456 destination if Enable Direct Hot Dial = \u00a0True and returns error if Enable Direct Hot Dial = false (by default).</p><hr><blockquote dir=\"ltr\">12 Smart Dial Exclusive Mode<br>\u00a0Should the Smart Dial DID be shared amongst many accounts</blockquote><p dir=\"ltr\">This option should be left false by default. If it is set to true, only 1 \u00a0account will be able to add DID number assigned to this IVR application \u00a0as Smart Dial number.</p><hr><blockquote dir=\"ltr\">13 Early Greeting Prompt ID<br>\u00a0The Prompt ID to be played before the language selection menu. This \u00a0prompt cannot be localized. See an example at the end of the page.</blockquote><p dir=\"ltr\">This option should let you use your custom greeting when you're calling that IVR application.</p><hr><blockquote dir=\"ltr\">14 VoodooVox Source Key<br>\u00a0The source key for VoodooVox Ads</blockquote><p dir=\"ltr\">This option is related to the VoodooVox ads provider. Please contact us if you need more details about it.</p></div></div>",
  "description_text": "   Setting up DID for Calling Card IVR Application      Add an IVR Application of type 'Calling Card' in 'IVR Applications' menu on the Web. After creation of the application use Advanced Parameters to customize the application for your needs.  Use the 'DID Pool' menu to add a DID and assign your newly created Calling Card IVR Application to it.      Call routing setup (obsolete)      Add vendor connection. Set the Asterisk's host/port in the Destination field of Vendor Connection (ex: 192.168.0.100:5062).  Set the CLD Translation Rule for the connection to the value s/.*/callingcard/. Optionally the set of options can be specified in the CLD - see the specs below.  Add route to this connection and specify the Calling Card Extension number.      Configuration options     Basic options:   Option   Meaning   Default  Announce Balance  Whether to announce balance upon successful start of application  Yes    Normal Calls Are Allowed   Only service codes enabled if this option is False No outgoing calls will be processed by this CC IVR application while only the Service Codes will be processed if that option option set to 'false' .    True  Disconnect On Failure  Whether to drop the Calling Card session upon unsuccessful call attempt. Otherwise the application announces that the failure occurred and offers the user to enter another destination.  No   Allow Empty PIN  Whether to permit to use the prepaid card accounts with empty PIN  true  Preserve Original CLI  CLI from the initial call leg will be used to call destination if this option set to true. The calling card username will be used as CLI otherwise.  false   Maximum Call Duration  Maximum call duration  3600 seconds   Card Number Length  Maximum number of digits allowed in a card number  10   Number_Of_Attempts_To_Enter_A_Card  Maximum number of attempts to enter card number or PIN code  3   Number Of Wrong Destinations  Maximum allowed number of unsuccessful call attempts in a row  3   Number Of Timeouts  Maximum number of input timeouts  3   Minimum Call Duration  Minimum allowed call duration (in seconds). If calculated maximum duration of the call to the requested destination is less than this value then the user will hear the prompt \"You have insufficient funds to make this call\"  10   Minimum Card Number Length  Minimum number of digits allowed in a card number     No Seconds In Duration  Do not pronounce seconds while announcing call duration. If the duration is less than 1 minute then this option is ignored.  False   No Hours In Duration  Do not speak out hours while announcing call duration, only minutes  False   Announce Duration  Should the duration of the call be announced  True   Call Several Destinations  Only one call attempt per session is allowed if this option is False. Equal to noredial\u00a0option   True   Outbound SIP Proxy  SIP proxy host:port to send the outbound calls to (this option can also be set from the command line).  This option can be useful if the outgoing calls should be processed by the external switch\\server instead of the built-in b2bua service for placing the outbound calls to your Vendors.   <Environment_IP>:5061  Disconnect Warning Time  Say \u00a0'Your call will be disconnected in N seconds'\u00a0\u00a0before the call disconnect  60   Play Service Plan Minutes Only  Play service plan minutes instead of a sum of plan minutes and duration calculated by tariff. This option does not affect actual maximum duration of a call which is a sum of plan minutes and duration calculated by tariff.  False  Destination Number Completion Regex  Treat the destination number to have been completed and immediately continue with the call when the input matches the given regular expression pattern     The Reason For Diversion *   The reason parameter for the Diversion SIP header   unconditional   * starting from Sippy 2020     Trusted CLI related options     Option   Meaning   Default  Enable CLI Registration  If the 'CLI Registration' sub application is enabled, then the corresponding IVR prompt will be played and the user will be asked to link its <ANI\\CLI> number as the 'Trusted Number' to the used <Calling Card\\PIN> for further possible PINless dialing.       Automatic CLI Registration  After calling card has been entered successfully, add the current CLI to the list of trusted CLIs for this calling card. If the authorization is successful after entering the <Calling Card\\PIN>, then the user's <ANI\\CLI> number will be added as the 'Trusted Number' to the used <Calling Card\\PIN> for further possible PINless dialing.   No   Silent Automatic CLI Registration  When this option is set to False the user will be prompted if he wishes to register his phone number (new in 1.7.1). The same as in Automatic CLI Registration, but the user will be asked whether its number should be added as the 'Trusted Number' to the used <Calling Card\\PIN> for further possible PINless dialing   True   CLI Registration Menu Extension Number  Extension number for the CLI Registration Subapplication. Exact extension number that can be entered to reach the CLI Registration Sub application while connected to that CC IVR application.  any value from 0 to 9   Trusted CLI Authentication  Allow to use Trusted Numbers for authentication.  False   Minimum Valid CLI Length  Minimum CLI length that is allowed to trigger the Automatic CLI Registration.  6      Password change     Option  Meaning   Default  Enable Password Change  If password change enabled   True   Change Password Menu Extension Number    Extension number for the Change Password Subapplication.    any value from 0 to 9   Billing related options:   Option  Meaning  Default  Balance Threshold  If the balance of the card is below this threshold then the card number will be asked even if CLI authentication is successful. Please note that this option doesn't disable cards with the balance below threshold, it just forces the PIN to be entered despite the fact the CLI authentication was successful. If you want to disable cards with low balance, please use the Minimum Balance option. (new in 1.8)  The value of the Minimum Balance option  Minimum Balance  If the balance of the card becomes less than the specified value then the card becomes unavailable. The balance can be specified with or without currency. Currency may follow the balance value, ex: '2 USD'. When no currency specified then the balance checked as an absolute value regardless of card's currency (updated in 1.7.1)  NULL  Ignore Connect Fee  Do not use connect_fee in the duration calculations  False   Say_Negative_Balance_As_Zero  When option is and if balance is under zero then say \"You have zero dollars\". Say \"You have minus <amount> dollars\" if this option disabled.   True      Authentication     Option  Meaning  Default  Use CLI Authentication Only  Only accounts with existing CLI mapping are allowed to enter. IVR system will authorize incoming calls by trust CLI method.  False   CLI As Card Number  Try to use CLI as card number first before other methods  False   Use VoIP Login As Card Number  Look for a calling card in the accounts table by the authname field (normally the username field is used).  False  PIN-less CLI Authentication  Option applicable for any IVR application since 4.4, if any kind of CLI authentication has succeeded then do not ask for PIN even if it is set. The CLI authentication includes CLI As Card Number, Trusted Numbers\u00a0and\u00a0Smart Dial.  False   Allow Own Accounts Only  Option applicable for any IVR application since 4.4, if enabled then only accounts of the customer that has created this IVR application would be allowed to use it.   False     Custom scripts:   Option  Meaning  Default  Custom Script To Check Destination  Set the path to the destination check script. Destination Check Script - is a Python script. The script is to be put into some file (/home/ssp/check_dest.py for example) and path to this script is to be added to the configuration. This file has to contain the function checkDestination() with six mandatory parameters - CLI, translated CLI, CLD, translated CLD, username of account making the call and original CLI of the IVR session. The function must return boolean value where True means that the destination is allowed and False - destination is prohibited. Script is loaded dynamically so there is no need to restart ivrd after the script has been changed. Should any problem occur during script load, the script is disabled and corresponding error message is written to the log. If any problem occur during script execution, the Calling Card application treats this as a prohibition to make call.      Custom Script To Change Announced Duration  Script to calculate custom duration to be announced to the user. Duration Script - The script is run with the following parameters: account's username, account's balance, CLI, CLD, calculated maximum duration (in seconds), i_tariff, translated CLI and translated CLD. The script must print to the stdout a duration that is to be announced to the user. Please note that the duration returned from the script does not affect the maximum session time, it only changes the duration announcement message.        Hot Dial & Smart Dial   Option  Meaning  Default  Enable Direct Hot Dial  Single digit destinations dialed from main menu will be treated as hot dial keys if this option is true  False   Enable Hot Dial  If the Hot Dial subapplication enabled. Enable Direct Hot Dial option is applied for accounts which use Hot Dial feature. In this case, single digit destinations dialed from main menu will be treated as hot dial keys. For example account uses Hot Dial Key 5 with Destination number 123456. Pressing 5# in Calling Card IVR initiates call to the 123456 destination if Enable Direct Hot Dial = True and returns error if Enable Direct Hot Dial = false (by default).   True   Hot Dial Edit Menu Extension  Extension number to edit the Hot Dial keys     Hot Dial Menu Extension  Hot Dial extension number     Limit Hot Keys  If true then only keys 1, 2 and 3 can act as the hot dial keys  False   Smart Dial Exclusive Mode  Should the Smart Dial DID be shared amongst many accounts.  This option should be left false by default. If it is set to true, only 1 account will be able to add DID number assigned to this IVR application as Smart Dial number.   False         Top-Up   Option  Meaning  Default  Enable Top-Up feature  If the Topup subapplication enabled  True   Top-Up Card Length  The maximum allowed number of digits of top-up card \u00a0   10   Top Up Menu Extension  Extension number for Top-Up Card Subapplication.    any value from 0 to 9   Black List    Please note that attempts to enter numbers less than 4 digits long are not treated as fraud activity. Only numbers more than 3 digits long trigger black list.   Option  Meaning  Default  Enable Black List  If the blacklist feature turned on.  False  Number Of Attempts To Blacklist  How many wrong calling card numbers should be entered in a row to blacklist the current CLI.  3      Miscellaneous     Option  Meaning  Default  Use Word PIN  Enable one-step authentication. With the Use Word Pin option set to false the PIN\u00a0would be asked after entering the card number for accounts that have PIN configured. Case PIN is not set for Account, authentication will proceed without it, unless Allow Empty PIN is set to false, in such case call would be dropped with PIN set request. Thus if you need to add extra security to the system, setting this parameter to False would be a good idea, as it'd require entering both card number and a secret PIN of that card. Also applicable to Top-Up IVR application, to enable top-up vouchers PINs. Use word PIN\u00a0in all phrases regarding card number. So for example phrase \"Enter card number\" will sound \"Enter PIN code\" and so on... Please note that this option disables the password check.  True   Suppress Pound Phrase  Do not say \"...followed by the pound key\" when asking destination number and PIN  False   Enable Custom Greeting  If the custom language independent greeting enabled (it is played at the very beginning of the application before the language selection)  No   Custom Greeting File  Path to the custom language independent greeting audio file (it is played at the very beginning of the application before the language selection). Path has to be specified omitting the file extension, in the same folder there must be versions for all needed extensions (sln, g729, possibly g723). Example: /usr/home/ssp-root/my_custom_prompt      Early Greeting Prompt ID  The Prompt ID to be played before the language selection menu. This prompt cannot be localized. See an example at the end of the page. This option let you use the custom greeting when you're calling to the IVR app.      Late Greeting Prompt ID  The Prompt ID to be played after the language selection menu before balance announcement. This prompt can be localized. See an example at the end of the page.     VoodooVox Source Key  The source key for VoodooVox Ads  None   Default Calling Card Language  Default fall back language  en   Fallback_To_Default_Calling_Card_Language  Whether to fall back to default language after the maximum number of wrong attempts to select the language have been made.  No   Say 'No Card' On Low Balance  Say \"Wrong card number (PIN code)\" instead of \"There is no available balance left in this calling card\". (New in 3.0)  True      Destination Check Script     This is a Python script in the following format. The script is to be put into some file (/home/ssp/check_dest.py for example) and path to this script is to be added to the configuration. This file has to contain the function checkDestination() with six mandatory parameters - CLI, translated CLI, CLD, translated CLD, username of account making the call and original CLI of the IVR session. The function must return boolean value where True means that the destination is allowed and False - destination is prohibited. This script is loaded dynamically so there is no need to restart ivrd after the script has been changed. Should any problem occur during script load, the script is disabled and corresponding error message is written to the log. If any problem occur during script execution, the Calling Card application treats this as a prohibition to make call.     Duration Script   The script is run with the following parameters: account's username, account's balance, CLI, CLD, calculated maximum duration (in seconds), i_tariff, translated CLI and translated CLD. The script must print to the stdout a duration that is to be announced to the user. Please note that the duration returned from the script does not affect the maximum session time, it only changes the duration announcement message.     Database usage   The application uses the accounts\u00a0table for authentication purposes, to retrieve the value of the user's balance, to make balance transfers and to change password.  The calling_card_cli_map table is used to store CLI-to-CallingCard mappings. These mappings are used to automatically select the calling card account based on the CLI of the user.     Use of multiple instances of Calling Card Application   The application can be configured not only via central configuration but also by CLD rewriting. This allows to use several differently configured instances of application within the same server. The CLD options always override the corresponding global configuration options.  The following parameters are accepted.     chpassext<ext>  Specify the Change Password extension for this instance  cliregext<ext>  Specify the CLI Registration extension for this instance  directhotdial  Destinations 1, 2 and 3 dialed from main menu will be treated as hot dial keys if this option is specified  earlymedia  Use early media mode till the destination has answered  greet<i_ivr_prompt>  Use prompt from the ivr_prompts table as a greeting (new in 1.7)  hotdialext<ext>  Hot Dial extension number  hotdialeditext<ext>  Extension number to edit Hot Dial keys  keepcli  Use original CLI to call destination  lgreet<i_ivr_prompt>  Use prompt from the ivr_prompts table as a late greeting. This greeting is language aware, unlike the greet option (new in 1.7).  nocardenter or climaponly  Exit immediately if no CLI mapping has been found  nochpass  Change Password extension is disabled regardless if it specified or not  nocliauth  Do not try to use CLI as card number  noclireg  CLI Registration extension is disabled regardless if it specified or not  nodial  Disallow outside calls. This is useful if service codes only are to be available.  nohotdial  Disable Hot Dial fetature, both dial and edit keys capabilities  nokeepcli  Use calling card username as CLI to call destination  noplaybalance or nobalance  Disallow balance announcement  noplayduration or noduration  Disable call duration limit announcement  noredial  Hangup after the call attempt regardless it was successful or not  notopup  Top-Up extension is disabled regardless if it specified or not  planminutes  Play service plan minutes instead of a sum of plan minutes and duration calculated by tariff. This option does not affect actual maximum duration of a call which is a sum of plan minutes and duration calculated by tariff.  playbalance  Allow balance announcement  topup  Start Top-Up Card subapplication instead of main Calling Card loop. All functionality except Top-Up Card is disabled.  topupext<ext>  Specify the Top-Up extension for this instance  trustcli  CLI mapping is trusted so the PIN is never asked  trycliauth or cliauth  Try to use CLI as card number first before other methods     All other two-character parameters are treated as language list specification.  Example of CLD rewriting rule:      s/.*/callingcard_en_th_ru_cliregext003_trustcli_noplaybalance/     The balance of account won't be played in the following cases:   there is a minutes plan configured in the service plan of the account  service plan status is suspended  account's balance is equal to zero      Late Greeting example (new in 1.7)     Late Greeting lgreet feature allows to make \u00a0announcement after calling card has been identified and before the \u00a0balance played. To play the audio the IVR Prompts facility is used. The \u00a0facility allows to specify a language specific versions of the prompt. \u00a0Here is how one can prepare a prompt to work as a Late Greeting:     \u00a0- Create a prompt with the default audio recording:      $ /home/ssp/scripts/ivr_prompt_utils -c default_audio.sln late_greeting 'Long description'\nNew prompt created with i_ivr_prompt = 29      \u00a0- As you see the prompt created and was assigned an identifier of 29. Add \u00a0all needed localized recodings to this prompt (Thai and \u00a0  \u00a0 Chinese are \u00a0showed in the following example):      $ /home/ssp/scripts/ivr_prompt_utils -u 29 -a thai_audio.sln --lang=th\nIVR prompt updated\n$ /home/ssp/scripts/ivr_prompt_utils -u 29 -a chinese_audio.sln --lang=zh\nIVR prompt updated      \u00a0- Now you've prepared the prompt and can start to use it. Modify your CLD translation rule to include lgreet29. So the final rule  \u00a0 \u00a0may look like:      s/.*/callingcard_en_th_zh_ja_lgreet29/      - As you see the Japan and English languages are included here \u00a0also but we haven't prepared the corresponding localized prompts.  \u00a0 In \u00a0this example the users of the Calling Card that have chosen Japan or \u00a0English will hear the announcement in the default \u00a0  \u00a0 language (the audio \u00a0from the default_audio.sln file).     - Please note that the *.sln files must contain audio in \u00a0signed linear format. Almost any audio format can be relatively easily  \u00a0 converted to the signed linear format. Here is an example how to covert \u00a0'file.wav' into 'file.sln':     /usr/local/bin/sox file.wav -t raw -s -2 -r8000 -c1 file.sln     Notes     An i_environment must be specified since version 3.0 in a form:      ivr_prompt_utils.py -E I_ENVIRONMENT -c audio_file name description      Early Greeting example (new in 1.7)     Early Greeting greet feature allows to make \u00a0announcement before the user proposed to choose a language. The \u00a0procedure of setting up the greeting is very similar to the Late \u00a0Greeting except the language specific audio is not needed. Here is how \u00a0to prepare a prompt to work as an Early Greeting:      Create a prompt with the default audio recording:       $ /home/ssp/scripts/ivr_prompt_utils -c greet_audio.sln early_greeting 'This is an early prompt'\nNew prompt created with i_ivr_prompt = 30       The prompt is ready. Modify your CLD translation rule to include greet30. So the final rule may look like:       s/.*/callingcard_en_th_zh_ja_greet30/      Notes    CLI Registration extension relies on correct CLI delivery to the \u00a0application. Sometimes the CLI is not delivered correctly, or when PSTN \u00a0user blocks his CLI some bogus CLI is delivered instead. This may \u00a0result in user registering this bogus CLI and other users not being able \u00a0to use the service when they also have CLI disabled. Therefore routing \u00a0shall be configured to block any suspicious CLI, for example the \u00a0following CLI Translation Rule could be used to only pass 10-digits \u00a0numeric CLIs that start with 0:       \u00a0 \u00a0s/(^0[0-9]{9,9}$|^).*$/\\1/      \u00a0  Calling Card application allows the user to disconnect outgoing call by pressing pound sign twice in a row (##) \u00a0during any phase of the call.\n\nIf you want to deny some CLI \u00a0the possibility of adding itself to the trusted numbers (someone calls to the DID, that is assigned to Calling card IVR application in our system, authorize using some account \"Please, enter your PIN code\" and then can be prompted whether he wants to add the number he calls from as a trusted one) you'll have to do the following:\n\n1. Find out the CLI you want to ban\n2. Add the CLI translation rule to the specific DID number you want to be affected by the change, e.g. to ban CLI 33nonymous from adding it as a trusted one you'll need to add the following translation rule:\ns/^33nonymous$/Anonymous/\n\nAs a result if the incoming CLI = 33nonymous it'll be rewritten to Anonymous, which is not allowed to save itself to the trusted numbers by default.\nNo other CLI will be affected by this change.  \u00a0      Calling Card options explanation      1.Normal Calls Are Allowed \u00a0Only service codes enabled if this option is False  No outgoing calls will be processed by this CC IVR application while \u00a0only the Service Codes will be processed if that option option set to \u00a0'false' .    2. Outbound SIP Proxy   SIP proxy host:port to send the outbound calls to (this option can also be set from the command line)  This option can be useful if the outgoing calls should be processed by \u00a0the external switch\\server instead of the built-in b2bua service for \u00a0placing the outbound calls to your Vendors.   3. Enable CLI Registration \u00a0If the CLI Registration sub application enabled  If the 'CLI Registration' sub application is enabled, then the \u00a0corresponding IVR prompt will be played and the user will be asked to \u00a0link its <ANI\\CLI> number as the 'Trusted Number' to the used \u00a0<Calling Card\\PIN> for further possible PINless dialing.   4 Automatic CLI Registration \u00a0After calling card has been entered successfully, add the current CLI to the list of trusted CLIs for this calling card.  If the authorization is successful after entering the <Calling \u00a0Card\\PIN>, then the user's <ANI\\CLI> number will be added as \u00a0the 'Trusted Number' to the used <Calling Card\\PIN> for further \u00a0possible PINless dialing.   5.Silent Automatic CLI Registration \u00a0When this option is set to False the user will be prompted if he wishes to register his phone number (new in 1.7.1).  The same as in 4th case, but the user will be asked whether its number \u00a0should be added as the 'Trusted Number' to the used <Calling \u00a0Card\\PIN> for further possible PINless dialing   6 CLI Registration Menu Extension Number \u00a0Extension number for the CLI Registration Sub application  Exact extension number that can be entered to reach the CLI Registration \u00a0Sub application while connected to that CC IVR application.   7 Trusted CLI Authentication \u00a0CLI mapping is trusted so the PIN is never asked  That option enables the PINless dialing based on the Trusted Number. If \u00a0the user has already entered the <Calling Card\\PIN> successfully \u00a0during the previous session and its <ANI\\CLI> has been added to \u00a0the Trusted Numbers of the used <Calling Card\\PIN> and if that \u00a0user calls the CC IVR application second time using the same \u00a0<ANI\\CLI>, then no PIN will be asked (no authorization) in such \u00a0case, so that it will be only asked for the destination number to call.   8. Use CLI Authentication Only \u00a0Only accounts with existing CLI mapping are allowed to enter  You IVR system will authorize IVR call only by trust CLI method.   9. Custom Script To Check Destination Set the path to the destination check script  Destination Check Script - This is a Python script in the following \u00a0format. The script is to be put into some file (/home/ssp/check_dest.py \u00a0for example) and path to this script is to be added to the \u00a0configuration. This file has to contain the function checkDestination() \u00a0with six mandatory parameters - CLI, translated CLI, CLD, translated \u00a0CLD, username of account making the call and original CLI of the IVR \u00a0session. The function must return boolean value where True means that \u00a0the destination is allowed and False - destination is prohibited. This \u00a0script is loaded dynamically so there is no need to restart ivrd after \u00a0the script has been changed. Should any problem occur during script \u00a0load, the script is disabled and corresponding error message is written \u00a0to the log. If any problem occur during script execution, the Calling \u00a0Card application treats this as a prohibition to make call.   10 Custom Script To Change Announced Duration \u00a0Script to calculate custom duration to be announced to the user.  Duration Script - The script is run with the following parameters: \u00a0account's username, account's balance, CLI, CLD, calculated maximum \u00a0duration (in seconds), i_tariff, translated CLI and translated CLD. The \u00a0script must print to the stdout a duration that is to be announced to \u00a0the user. Please note that the duration returned from the script does \u00a0not affect the maximum session time, it only changes the duration \u00a0announcement message.   11 Enable Direct Hot Dial \u00a0Single digit destinations dialed from main menu will be treated as hot dial keys if this option is true  Enable Direct Hot Dial option is applied for accounts which use Hot Dial \u00a0feature. In this case, single digit destinations dialed from main menu \u00a0will be treated as hot dial keys. For example account uses Hot Dial Key 5 \u00a0with Destination number 123456. Pressing 5# in Calling Card IVR \u00a0initiates call to the 123456 destination if Enable Direct Hot Dial = \u00a0True and returns error if Enable Direct Hot Dial = false (by default).   12 Smart Dial Exclusive Mode \u00a0Should the Smart Dial DID be shared amongst many accounts  This option should be left false by default. If it is set to true, only 1 \u00a0account will be able to add DID number assigned to this IVR application \u00a0as Smart Dial number.   13 Early Greeting Prompt ID \u00a0The Prompt ID to be played before the language selection menu. This \u00a0prompt cannot be localized. See an example at the end of the page.  This option should let you use your custom greeting when you're calling that IVR application.   14 VoodooVox Source Key \u00a0The source key for VoodooVox Ads  This option is related to the VoodooVox ads provider. Please contact us if you need more details about it.   ",
  "seo_data": {
    "meta_title": "",
    "meta_description": "",
    "meta_keywords": ""
  },
  "tags": [],
  "attachments": [],
  "cloud_files": [],
  "thumbs_up": 3,
  "thumbs_down": 3,
  "hits": 2491,
  "suggested": 0,
  "feedback_count": 0,
  "collaboration": {
    "convo_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJUeXBlIjoiYXJ0aWNsZSIsIkNvbnZvSWQiOiI3ODI3OC1lbiIsIlVzZXJJZCI6IjMwMTIwODk1MjQiLCJleHAiOjE2MzUzNzExMjN9.mhhr1T-qnS82W27jJpz899YXyfGTZcXBTCkFPbMZ204"
  }
}