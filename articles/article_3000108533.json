{
  "id": 3000108533,
  "type": 1,
  "status": 2,
  "agent_id": 3901167,
  "created_at": "2021-06-30T12:24:43Z",
  "category_id": 107132,
  "folder_id": 176917,
  "title": "XML-RPC API - multicall example",
  "updated_at": "2021-08-11T09:22:57Z",
  "description": "<h3 data-identifyelement=\"497\" dir=\"ltr\" style=\"font-family: Arial, Verdana, &quot;Bitstream Vera Sans&quot;, Helvetica, sans-serif; font-weight: bold; break-after: avoid; font-size: 19px;\"><span style=\"font-size: 12px;\">See introduction to XMLAPI for details on Authentication:</span></h3><p><a href=\"https://support.sippysoft.com/a/solutions/articles/106909\">https://support.sippysoft.com/a/solutions/articles/106909</a></p><p><br></p><h2 dir=\"ltr\">Starting from Sippy 4.4 it's possible to use <a href=\"http://web.archive.org/web/20060824100531/http://www.xmlrpc.com/discuss/msgReader%241208\">MULTICALL</a> in XMLAPI.</h2><p dir=\"ltr\">This feature allows to \"pack\" N XMLAPI call into a single request to send to Server, instead of sending them one by one.</p><p dir=\"ltr\"><br></p><p dir=\"ltr\">Measured benchmark for the <a href=\"https://support.sippysoft.com/en/support/solutions/articles/107502-xml-rpc-api-dids-management\">addDID()</a> xmlapi call showed 3 times faster execution in multicall compared with regular one-by-one addition of 1000 DIDs:</p><p dir=\"ltr\">- 5m 20s in regular mode&nbsp;</p><p dir=\"ltr\">- 1m 39s in multicall.</p><p dir=\"ltr\"><br></p><h3 dir=\"ltr\"><strong>PYTHON example:</strong></h3><div><pre contenteditable=\"false\" data-code-brush=\"Python\" dir=\"ltr\" rel=\"highlighter\"># this script requires httplib2 to be installed\n# username should be Web Login of the Customer, password - API password\n# 1.2.3.4 should be replaced with target IP/hostname of Sippy Softswitch\nimport httplib2\nimport urllib\nfrom xmlrpclib import ServerProxy, getparser, ProtocolError, MultiCall\n\nclass HTTPSDigestAuthTransport:\n    def request(self, host, handler, request_body, verbose=0):\n        auth, host = urllib.splituser(host)\n        username, password = urllib.splitpasswd(auth)\n        h = httplib2.Http(disable_ssl_certificate_validation=True)\n        if verbose:\n            h.debuglevel = 1\n        h.add_credentials(username, password)\n        resp, content = h.request(\"https://\" + host + handler, \"POST\", body=request_body,\n                                  headers={'content-type':'text/xml'})\n        if resp.status != 200:\n            raise ProtocolError(\"https://\" + host + handler,\n                                resp.status, resp.reason, None)\n        p, u = getparser(0)\n        p.feed(content)\n        return u.close()\n\ntransport = HTTPSDigestAuthTransport()\nclient = ServerProxy(\"https://username:password@1.2.3.4/xmlapi/xmlapi\", transport)\nmulticall = MultiCall(client)\nmulticall.getAccountCallStats({ \"i_account\" : 1})\nmulticall.getAccountCallStats({ \"i_account\" : 1})\nmulticall.getAccountInfo({ \"i_account\" : -1}) # expect error here\nmulticall.getAccountCallStats({ \"i_account\" : 1})\n\nfor res in multicall().results:\n    if isinstance(res, dict):\n        print \"Fault\", res\n    else:\n        print res[0]</pre><p><br></p></div><h3 dir=\"ltr\"><strong dir=\"ltr\">PHP example:</strong></h3><div><pre contenteditable=\"false\" data-code-brush=\"Python\" rel=\"highlighter\">&lt;?\nset_include_path(get_include_path() . PATH_SEPARATOR . '/home/ssp/sippy_web/lib');\n\ninclude 'xmlrpc/xmlrpc.inc';\n\n$customer_web_login    = \"username\";\n$customer_api_password = \"password\";\n\n$params = array(new xmlrpcval(array(\n        \"i_environment\" =&gt; new xmlrpcval('1', \"int\"),\n    ), 'struct'));\n$msg = new xmlrpcmsg('getAccountCallStats', $params);\n\n$params2 = array(new xmlrpcval(array(\n        \"i_account\" =&gt; new xmlrpcval('-1', \"int\"), // expect error\n    ), 'struct'));\n$msg2 = new xmlrpcmsg('getAccountInfo', $params2);\n\n$cli = new xmlrpc_client('https://1.2.3.4/xmlapi/xmlapi');\n$cli-&gt;request_charset_encoding = 'UTF-8';\n$cli-&gt;setSSLVerifyPeer(false);\n$cli-&gt;return_type = 'phpvals';\n$cli-&gt;setDebug(2);\n\n//$cli-&gt;setCredentials($customer_web_login, $customer_api_password, CURLAUTH_DIGEST);\n\n$r = $cli-&gt;multicall(Array($msg, $msg, $msg2, $msg), 10, '', FALSE);\n\nprint_r($r);\n?&gt;</pre><p><br></p></div><p dir=\"ltr\"><br></p>",
  "description_text": " See introduction to XMLAPI for details on Authentication:  https://support.sippysoft.com/a/solutions/articles/106909     Starting from Sippy 4.4 it's possible to use MULTICALL in XMLAPI.  This feature allows to \"pack\" N XMLAPI call into a single request to send to Server, instead of sending them one by one.     Measured benchmark for the addDID() xmlapi call showed 3 times faster execution in multicall compared with regular one-by-one addition of 1000 DIDs:  - 5m 20s in regular mode\u00a0  - 1m 39s in multicall.     PYTHON example:   # this script requires httplib2 to be installed\n# username should be Web Login of the Customer, password - API password\n# 1.2.3.4 should be replaced with target IP/hostname of Sippy Softswitch\nimport httplib2\nimport urllib\nfrom xmlrpclib import ServerProxy, getparser, ProtocolError, MultiCall\n\nclass HTTPSDigestAuthTransport:\n    def request(self, host, handler, request_body, verbose=0):\n        auth, host = urllib.splituser(host)\n        username, password = urllib.splitpasswd(auth)\n        h = httplib2.Http(disable_ssl_certificate_validation=True)\n        if verbose:\n            h.debuglevel = 1\n        h.add_credentials(username, password)\n        resp, content = h.request(\"https://\" + host + handler, \"POST\", body=request_body,\n                                  headers={'content-type':'text/xml'})\n        if resp.status != 200:\n            raise ProtocolError(\"https://\" + host + handler,\n                                resp.status, resp.reason, None)\n        p, u = getparser(0)\n        p.feed(content)\n        return u.close()\n\ntransport = HTTPSDigestAuthTransport()\nclient = ServerProxy(\"https://username:password@1.2.3.4/xmlapi/xmlapi\", transport)\nmulticall = MultiCall(client)\nmulticall.getAccountCallStats({ \"i_account\" : 1})\nmulticall.getAccountCallStats({ \"i_account\" : 1})\nmulticall.getAccountInfo({ \"i_account\" : -1}) # expect error here\nmulticall.getAccountCallStats({ \"i_account\" : 1})\n\nfor res in multicall().results:\n    if isinstance(res, dict):\n        print \"Fault\", res\n    else:\n        print res[0]      PHP example:   <?\nset_include_path(get_include_path() . PATH_SEPARATOR . '/home/ssp/sippy_web/lib');\n\ninclude 'xmlrpc/xmlrpc.inc';\n\n$customer_web_login    = \"username\";\n$customer_api_password = \"password\";\n\n$params = array(new xmlrpcval(array(\n        \"i_environment\" => new xmlrpcval('1', \"int\"),\n    ), 'struct'));\n$msg = new xmlrpcmsg('getAccountCallStats', $params);\n\n$params2 = array(new xmlrpcval(array(\n        \"i_account\" => new xmlrpcval('-1', \"int\"), // expect error\n    ), 'struct'));\n$msg2 = new xmlrpcmsg('getAccountInfo', $params2);\n\n$cli = new xmlrpc_client('https://1.2.3.4/xmlapi/xmlapi');\n$cli->request_charset_encoding = 'UTF-8';\n$cli->setSSLVerifyPeer(false);\n$cli->return_type = 'phpvals';\n$cli->setDebug(2);\n\n//$cli->setCredentials($customer_web_login, $customer_api_password, CURLAUTH_DIGEST);\n\n$r = $cli->multicall(Array($msg, $msg, $msg2, $msg), 10, '', FALSE);\n\nprint_r($r);\n?>        ",
  "seo_data": {
    "meta_title": "",
    "meta_description": ""
  },
  "tags": [],
  "attachments": [],
  "cloud_files": [],
  "thumbs_up": 0,
  "thumbs_down": 0,
  "hits": 46,
  "suggested": 0,
  "feedback_count": 0,
  "collaboration": {
    "convo_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJUeXBlIjoiYXJ0aWNsZSIsIkNvbnZvSWQiOiIzMDAwMTA4NTMzLWVuIiwiVXNlcklkIjoiMzAxMjA4OTUyNCIsImV4cCI6MTYzNTM3MTExN30.e7JYjlzaugKb2uC2KTwzpbwcKhmbbaHnqQIuFckkrdM"
  }
}